$NetBSD: patch-aa,v 1.3 2000/11/16 02:27:05 wiz Exp $

--- Makefile.orig	Mon Oct  2 09:36:11 2000
+++ Makefile
@@ -1,11 +1,11 @@
-ZSNESFX=1
-ASMCPU=1
+#ZSNESFX=1
+#ASMCPU=1
 #SPC700ASM=1
 NETPLAY=1
 UNZIP=1
-GLIDE=1
+#GLIDE=1
 #GUI=1
-THREAD_SOUND=1
+#THREAD_SOUND=1
 
 ifdef ZSNESFX
 FXOBJ=i386/fxemu2b.o i386/fxemu2.o i386/fxemu2c.o i386/fxtable.o i386/sfxproc.o i386/zsnes.o i386/spc.o
@@ -19,7 +19,10 @@
 FXNO_DEPENDS=zsnes_fx
 endif
 
+ifdef NETBSD_USE_DGA
 LINUXDEFINES=-DUSE_DGA_EXTENSION -DUSE_VIDMODE_EXTENSION
+DGALIBS=-lXxf86dga -lXxf86vm
+endif
 
 ifdef SPC700ASM
 SOUNDOBJ=spctool/spc700.o spctool/dsp.o spctool.o spctool/soundmod.o spc.o
@@ -81,9 +84,9 @@
 CC = gcc
 NASM = nasm
 
-INCLUDES=-I/usr/X11R6/include -I/usr/local/include
+INCLUDES=-I${X11BASE}/include
 
-OPTIMISE=-O6 -mpentium -fno-exceptions -Wall -W -pedantic -pipe -fomit-frame-pointer 
+OPTIMISE=-fno-exceptions -Wall -W -pedantic -pipe -fomit-frame-pointer 
 
 #OPTIMISE=-g -fno-exceptions
 #-DMITSHM 
@@ -92,7 +95,6 @@
 -Ii386 \
 -I. \
 -Iunzip \
--DJOYSTICK_SUPPORT \
 -DZLIB \
 -DNO_INLINE_SET_GET \
 -DVAR_CYCLES \
@@ -118,9 +120,9 @@
 CFLAGS=$(CCFLAGS)
 
 .SUFFIXES: .o .cpp .c .cc .h .m .i .S .asm
-LDLIBS = -L/usr/X11R6/lib frame.o
+LDLIBS = -L${X11BASE}/lib -Wl,-R${X11BASE}/lib
 
-all: offsets snes9x ssnes9x
+all: offsets snes9x
 
 #ggisnes9x
 #xf86snes9x
@@ -138,7 +140,7 @@
 	./offsets >i386/offsets.h
 
 snes9x: $(OBJECTS) unix/x11.o $(GLIDEOBJS) $(GUIOBJS)
-	$(CCC) $(INCLUDES) -o $@ $(OBJECTS) $(GLIDEOBJS) unix/x11.o $(GUIOBJS) $(LDLIBS) $(GLIDELIBS) $(GUILIBS) -lXxf86dga -lXxf86vm -lXext -lX11 $(EXTRALIBS) -lz -lm
+	$(CCC) $(INCLUDES) -o $@ $(OBJECTS) $(GLIDEOBJS) unix/x11.o $(GUIOBJS) $(LDLIBS) $(GLIDELIBS) $(GUILIBS) $(DGALIBS) -lXext -lX11 $(EXTRALIBS) -lz -lm
 
 ssnes9x: $(OBJECTS) unix/svga.o $(GLIDEOBJS) 
 	$(CCC) $(INCLUDES) -o $@ $(OBJECTS) $(GLIDEOBJS) unix/svga.o $(LDLIBS) $(GLIDELIBS) -lvga -lvgagl -lz $(EXTRALIBS) -lm
@@ -168,7 +170,7 @@
 	$(CCC) $(INCLUDES) -c -E $(CCFLAGS) $*.S -o $@
 
 .asm.o:
-	$(NASM) -f elf -i. -ii386 -o $@ $*.asm
+	$(NASM) -f ${FILEFORMAT} -i. -ii386 -o $@ $*.asm
 
 .obj.o:
 	cp $*.obj $*.o
