--- makefile.orig	Sat Feb 27 09:29:46 1999
+++ makefile	Tue May 30 21:16:47 2000
@@ -35,8 +35,6 @@
 ##============================================================================
 
-CXX      = g++
-LD       = g++
+LD       = ${CXX}
 
-LDFLAGS  = 
 LDLIBS   = 
 
@@ -47,5 +45,5 @@
 INCLUDES = -I. -I$(CORE) -I$(CORE)/m6502/src -I$(CORE)/m6502/src/bspf/src
 
-CXXFLAGS = -O -Wall $(INCLUDES) $(SYS_INCLUDES)
+CXXFLAGS += $(INCLUDES) $(SYS_INCLUDES)
 
 default:
@@ -79,8 +77,7 @@
 	make xstella \
           INCLUDES="$(INCLUDES) -I$(UI)/x11 -I$(UI)/sound" \
-          SYS_INCLUDES="" \
+          SYS_INCLUDES="-I$(X11BASE)/include" \
           OPTIONS="-DBSPF_UNIX" \
-          LDFLAGS="-L/usr/X11R6/lib" \
-          LDLIBS="-lX11 -lXext" \
+          LDLIBS="-L$(X11BASE)/lib -lX11 -lXext" \
           OBJS="mainX11.o SndUnix.o"
 
@@ -325,6 +322,12 @@
 	$(CXX) -c $(CXXFLAGS) $(OPTIONS) $(CORE)/m6502/src/M6502Low.cxx
 
+.if (${MACHINE_ARCH} == "mipsel") || (${MACHINE_ARCH} == "sparc")
+# avoide compiler bug on some systems
+M6502Hi.o: $(CORE)/m6502/src/M6502Hi.cxx
+	$(CXX) -c  -fno-rtti -fno-rtti $(INCLUDES) $(SYS_INCLUDES) $(OPTIONS) $(CORE)/m6502/src/M6502Hi.cxx
+.else
 M6502Hi.o: $(CORE)/m6502/src/M6502Hi.cxx
 	$(CXX) -c $(CXXFLAGS) $(OPTIONS) $(CORE)/m6502/src/M6502Hi.cxx
+.endif
 
 NullDev.o: $(CORE)/m6502/src/NullDev.cxx
