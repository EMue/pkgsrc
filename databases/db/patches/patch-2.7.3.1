$NetBSD: patch-2.7.3.1,v 1.2 1999/04/19 22:11:34 tron Exp $

*** ../log/log_register.c.orig	Fri Jan 15 10:35:52 1999
--- ../log/log_register.c	Fri Feb 12 08:35:00 1999
***************
*** 70,78 ****
  	 */
  	for (maxid = 0, fnp = SH_TAILQ_FIRST(&dblp->lp->fq, __fname);
  	    fnp != NULL; fnp = SH_TAILQ_NEXT(fnp, q, __fname)) {
! 		if (fnp->ref == 0 && reuse_fnp == NULL) {
! 			/* Entry is not in use. */
! 			reuse_fnp = fnp;
  			continue;
  		}
  		if (!memcmp(dbp->fileid, fnp->ufid, DB_FILE_ID_LEN)) {
--- 70,78 ----
  	 */
  	for (maxid = 0, fnp = SH_TAILQ_FIRST(&dblp->lp->fq, __fname);
  	    fnp != NULL; fnp = SH_TAILQ_NEXT(fnp, q, __fname)) {
! 		if (fnp->ref == 0) {		/* Entry is not in use. */
! 			if (reuse_fnp == NULL)
! 				reuse_fnp = fnp;
  			continue;
  		}
  		if (!memcmp(dbp->fileid, fnp->ufid, DB_FILE_ID_LEN)) {
