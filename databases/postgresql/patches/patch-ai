$NetBSD: patch-ai,v 1.3 1999/09/19 04:24:55 jlam Exp $

--- ./configure.orig	Sat May 29 20:06:44 1999
+++ ./configure	Sat Sep 18 03:21:47 1999
@@ -628,11 +628,7 @@
     bsdi*) os=bsdi need_tas=no ;;
  freebsd1*|freebsd2*) os=freebsd need_tas=no ;;
  freebsd*) os=freebsd need_tas=no elf=yes ;;
-  netbsd*)
-	os=bsd need_tas=no
-	case "$host_cpu" in
-	  powerpc) elf=yes ;;
-	esac ;;
+  netbsd*) os=bsd need_tas=no elf=maybe ;;	# mix of a.out & ELF platforms
   openbsd*) os=bsd need_tas=no ;;
     dgux*) os=dgux need_tas=no ;;
      aix*) os=aix need_tas=no ;;
@@ -663,13 +659,6 @@
    exit;;
 esac
 
-if test "X$elf" = "Xyes"
-then
-	ELF_SYS=true
-else
-	ELF_SYS=
-fi
-
 if test "X$need_tas" = "Xyes"
 then
 	
@@ -1418,6 +1407,23 @@
 
 LDFLAGS="$LDFLAGS $PGSQL_LDFLAGS"
 echo "- setting LDFLAGS=$LDFLAGS"
+
+# Check for ELF after finding compiler.
+case "X$elf" in
+Xmaybe)
+	if ${CC} -E - -dM </dev/null | grep -q __ELF__; then
+		ELF_SYS=true
+	else
+		ELF_SYS=
+	fi
+	;;
+Xyes)
+	ELF_SYS=true
+	;;
+*)
+	ELF_SYS=
+	;;
+esac
 
 
 
