$NetBSD: patch-ar,v 1.4 1999/12/29 16:05:11 bad Exp $

--- mit-pthreads/machdep/syscall-sparc-netbsd-1.3.S.orig	Mon Jun  7 12:34:23 1999
+++ mit-pthreads/machdep/syscall-sparc-netbsd-1.3.S	Wed Dec 29 00:31:23 1999
@@ -9,16 +9,17 @@
 	.asciz "$Id: patch-ar,v 1.4 1999/12/29 16:05:11 bad Exp $";
 #endif
  
+#include <machine/asm.h>
 #include <sys/syscall.h>
 
 #define	SYSCALL(x)					\
-	.globl _machdep_sys_##x;		\
-									\
-_machdep_sys_##x:;					\
-									\
-	mov SYS_##x, %g1;   			\
-	ta 0;							\
-	bcs,a 2b;						\
+	.globl _C_LABEL(machdep_sys_##x);		\
+							\
+_C_LABEL(machdep_sys_##x):;				\
+							\
+	mov SYS_##x, %g1;   				\
+	ta 0;						\
+	bcs,a 2b;					\
 	sub %r0,%o0,%o0;				\
 	retl							
 
@@ -43,9 +44,9 @@
 /* ==========================================================================
  * machdep_sys_pipe()
  */
-    .globl _machdep_sys_pipe
+    .globl _C_LABEL(machdep_sys_pipe)
 
-_machdep_sys_pipe:
+_C_LABEL(machdep_sys_pipe):
     mov  %o0, %o2
     mov  SYS_pipe, %g1
     ta  0
@@ -59,65 +60,65 @@
 /* ==========================================================================
  * machdep_sys_fork()
  */
-    .globl _machdep_sys_fork;
+    .globl _C_LABEL(machdep_sys_fork);
 
-_machdep_sys_fork:;
+_C_LABEL(machdep_sys_fork):;
 
     mov SYS_fork, %g1;
     ta 0;
     bcs 1b;
     nop;
-	dec %o1;
+    dec %o1;
     retl;
-	and %o0, %o1, %o0;	! return 0 in child, pid in parent
+    and %o0, %o1, %o0;	! return 0 in child, pid in parent
 
 #ifndef SYS___sigprocmask14
 /* ==========================================================================
  * machdep_sys_sigprocmask()
  */
-    .globl _machdep_sys_sigprocmask;
+    .globl _C_LABEL(machdep_sys_sigprocmask);
 
-_machdep_sys_sigprocmask:;
+_C_LABEL(machdep_sys_sigprocmask):;
 
-	ld [%o1], %o1; 
+    ld [%o1], %o1; 
     mov SYS_sigprocmask, %g1;
     ta 0;
     bcs 1b;
     nop;
     retl
-	nop
+    nop
 #endif
 
 #ifndef SYS___sigsuspend14
 /* ==========================================================================
  * machdep_sys_sigsuspend()
  */
-    .globl _machdep_sys_sigsuspend;
+    .globl _C_LABEL(machdep_sys_sigsuspend);
 
-_machdep_sys_sigsuspend:;
+_C_LABEL(machdep_sys_sigsuspend):;
 
-	ld [%o0], %o0; 
+    ld [%o0], %o0; 
     mov SYS_sigsuspend, %g1;
     ta 0;
     bcs 1b;
     nop;
     retl
-	nop
+    nop
 #endif
 
 /* ==========================================================================
  * machdep_sys_fstat()
  */
-    .globl _machdep_sys_fstat;
+    .globl _C_LABEL(machdep_sys_fstat);
 
-_machdep_sys_fstat:;
+_C_LABEL(machdep_sys_fstat):;
 
     mov SYS___fstat13, %g1;
     ta 0;
     bcs 1b;
     nop;
     retl
-	nop
+    nop
 
 /* ==========================================================================
  * machdep_sys___syscall()
@@ -129,14 +130,14 @@
     bcs 1b;
     nop;
     retl
-	nop
+    nop
 
 /* ==========================================================================
  * machdep_sys_lseek()
  */
-	.global _machdep_sys_lseek
+	.global _C_LABEL(machdep_sys_lseek)
 
-_machdep_sys_lseek:
+_C_LABEL(machdep_sys_lseek):
 	save %sp,-112,%sp
 	mov %i1,%o4
 	mov %i2,%o5
@@ -154,9 +155,9 @@
 /* ==========================================================================
  * machdep_sys_ftruncate()
  */
-	.global _machdep_sys_ftruncate
+	.global _C_LABEL(machdep_sys_ftruncate)
 
-_machdep_sys_ftruncate:
+_C_LABEL(machdep_sys_ftruncate):
 	save %sp,-104,%sp
 	mov %i1,%o4
 	mov %i2,%o5
