$NetBSD: patch-aa,v 1.2 1999/05/09 16:41:15 tron Exp $

--- Makefile.orig	Tue May  4 12:02:27 1999
+++ Makefile	Sun May  9 17:40:24 1999
@@ -2,17 +2,16 @@
 # Please read docs/Readme.html, or http://www.statslab.cam.ac.uk/~sret1/analog/
 CC = gcc           # which compiler to use: eg cc, acc, gcc. NB Different
 #                    compilers need different CFLAGS, e.g., -O instead of -O2.
-CFLAGS = -O2       # options, e.g. for optimisation or ANSI compilation.
-#                    HP/UX cc needs -Aa (HP/UX 9) or -Ae (HP/UX 10)
-#                    Some Linuces might need -I/usr/src/linux/include
-#                    BS2000/OSD requires -XLLML -XLLMK
-DEFS =             # any of -DNOPIPES -DNODNS -DNODIRENT -DEBCDIC ...
+CEXTRAFLAGS = -O2  # options, e.g. for optimisation or ANSI compilation.
+#                    HP/UX cc requires CEXTRAFLAGS = -Aa (HP/UX 9) or ...
+#                    -Ae (HP/UX 10);       BS2000/OSD requires -XLLML -XLLMK
+DEFS = -DPREFIX=\"${PREFIX}\"
+                   # any of -DNOPIPES -DNODNS -DNODIRENT -DEBCDIC ...
 #                    ... -DNEED_STRCMP -DNEED_MEMMOVE -DNEED_STRTOUL ...
-#                    ... -DNEED_DIFFTIME -DNEED_FLOATINGPONT_H
+#                    ... -DNEED_DIFFTIME -DNEED_FLOATINGPOINT_H
 #                    Solaris 2 (SunOS 5) might need DEFS = -DNEED_STRCMP
 #                    SunOS 4 probably needs...
-#    DEFS = -DNEED_MEMMOVE -DNEED_STRTOUL -DNEED_DIFFTIME -DNEED_FLOATINGPONT_H
-#                    but even then it may have bugs.
+#   DEFS = -DNEED_MEMMOVE -DNEED_STRTOUL -DNEED_DIFFTIME -DNEED_FLOATINGPOINT_H
 OS = UNIX          # Operating system: UNIX, DOS, WIN32, MAC, OS2, VMS
 #                    RISCOS, BEOS, BS2000
 LIBS =             # extra libraries needed; Solaris 2 (SunOS 5) needs
@@ -29,29 +28,31 @@
 	macinput.o macstuff.o output.o output2.o process.o settings.o \
 	sort.o tree.o utils.o win32.o
 HEADERS = analhead.h analhea2.h macdir.h
+CFLAGS = $(CEXTRAFLAGS) $(DEFS) -D$(OS)
 
 # Form interface options:
 FORMPROG = anlgform.cgi     # The program that processes the data from the form
 FORMSRC = anlgform.c        # The source code for that program
 
 $(PROGRAM): $(OBJS) $(HEADERS) Makefile
-	$(CC) $(CFLAGS) $(OBJS) -o $(PROGRAM) $(LIBS)
+	$(CC) $(CEXTRAFLAGS) $(OBJS) -o $(PROGRAM) $(LIBS)
 	@echo '***'
 	@echo '***IMPORTANT: You must read the licence before using analog'
 	@echo '***'
 
+# Some make's won't pick up this rule but their .c.o rule should be good enough
 %.o: %.c $(HEADERS) Makefile
-	$(CC) $(CFLAGS) $(DEFS) -D$(OS) -c $<
+	$(CC) $(CFLAGS) -c $<
 
 $(FORMPROG): $(FORMSRC) Makefile
-	$(CC) $(CFLAGS) $(FORMSRC) -o $(FORMPROG)
+	$(CC) $(CEXTRAFLAGS) $(FORMSRC) -o $(FORMPROG)
 
 form: $(FORMPROG)
 
 force:
 	rm -f $(OBJS)
-	make $(PROGRAM) 'CFLAGS=$(CFLAGS)' 'LIBS=$(LIBS)' 'DEFS=$(DEFS)' \
-	CC=$(CC)
+	make $(PROGRAM) 'CEXTRAFLAGS=$(CEXTRAFLAGS)' 'LIBS=$(LIBS)' \
+	'DEFS=$(DEFS)' CC=$(CC)
 
 clean:
 	rm -f *.o analog *~
