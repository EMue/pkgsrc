# $NetBSD: Makefile,v 1.6 2000/09/05 09:33:17 jlam Exp $

DISTNAME=	libapache-mod-dtcl_0.8.1-1
PKGNAME=	ap-dtcl-0.8.1
WRKSRC=		${WRKDIR}/mod_dtcl
CATEGORIES=	www
MASTER_SITES=	http://master.debian.org/~davidw/mod_dtcl/

MAINTAINER=	jwise@netbsd.org
HOMEPAGE=	http://comanche.com.dtu.dk/dave/

DEPENDS+=	apache-1.3.*:../../www/apache
DEPENDS+=	tcl-8.3.2:../../lang/tcl
# For "apxs":
BUILD_DEPENDS=	${PERL5}:../../lang/perl5-base

INCLUDES=	-I${PREFIX}/include/
LIBS=		-L${PREFIX}/lib -Wl,-R${PREFIX}/lib -ltcl83 -lm

do-build:
	cd ${WRKSRC} && ${PREFIX}/sbin/apxs ${INCLUDES} ${LIBS} -c mod_dtcl.c
	cd ${WRKSRC} && ${CC} -DDEBUG_SCRIPT_DIR=\"${PREFIX}/libexec/mod_dtcl/\" \
		${INCLUDES} -o testdtcl testdtcl.c ${LIBS}
	${SED} -e s,/usr/lib,${PREFIX}/libexec,g < ${WRKSRC}/testdtcl.1 > ${WRKSRC}/testdtcl.1.new

do-install:
	@cd ${WRKSRC} && ${PREFIX}/sbin/apxs -i mod_dtcl.so
	-${MKDIR} ${PREFIX}/share/doc/mod_dtcl
	${INSTALL_DATA} ${WRKSRC}/*.html ${PREFIX}/share/doc/mod_dtcl
	${INSTALL_DATA} ${WRKSRC}/*.gif ${PREFIX}/share/doc/mod_dtcl
	-${MKDIR} ${PREFIX}/share/examples/mod_dtcl
	${INSTALL_DATA} ${WRKSRC}/*.ttml ${PREFIX}/share/examples/mod_dtcl
	${INSTALL_DATA} ${WRKSRC}/contrib/*.ttml ${PREFIX}/share/examples/mod_dtcl
	-${MKDIR} ${PREFIX}/libexec/mod_dtcl
	${INSTALL_DATA} ${WRKSRC}/*.tcl ${PREFIX}/libexec/mod_dtcl
	${INSTALL_PROGRAM} ${WRKSRC}/testdtcl ${PREFIX}/bin
	${INSTALL_DATA} ${WRKSRC}/testdtcl.1.new ${PREFIX}/man/man1/testdtcl.1

.include "../../mk/bsd.pkg.mk"
