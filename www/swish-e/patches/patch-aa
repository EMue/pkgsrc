$NetBSD: patch-aa,v 1.2 1999/12/14 16:30:02 bouyer Exp $

--- fs.c.orig	Wed Jan  6 19:27:02 1999
+++ fs.c	Tue Dec 14 17:12:54 1999
@@ -41,7 +41,6 @@
 static struct swline *titconlist = 0;
 static struct swline *fileislist = 0;
 static struct swline *suffixlist = 0;
-static struct swline *nocontentslist = 0;
 
 
 /* Have we already indexed a file or directory?
@@ -365,23 +364,28 @@
 int ishtml(filename)
 char *filename;
 {
-	char *c, suffix[MAXSUFFIXLEN];
+	char *c, *d;
 	
+	d = (char *) strrchr(filename, '/');
 	c = (char *) strrchr(filename, '.');
 	
+	/* make sure the . is part of the filename */
+	if (d != NULL && c < d) {
+		return 0;
+	}
+	
 	if (c == NULL)
 		return 0;
-	strcpy(suffix, c + 1);
-	if (suffix[0] == '\0')
+	if (c++ == '\0')
 		return 0;
 	
-	if (!strncmp(suffix, "htm", 3))
+	if (!strncmp(c, "htm", 3))
 		return 1;
-	else if (!strncmp(suffix, "HTM", 3))
+	else if (!strncmp(c, "HTM", 3))
 		return 1;
-	else if (!strncmp(suffix, "shtml", 5))
+	else if (!strncmp(c, "shtml", 5))
 		return 1;
-	else if (!strncmp(suffix, "SHTML", 5))
+	else if (!strncmp(c, "SHTML", 5))
 		return 1;
 	return 0;
 }
