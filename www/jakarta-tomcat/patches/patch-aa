$NetBSD: patch-aa,v 1.7 2001/06/21 13:12:27 abs Exp $

--- build.xml.orig	Tue Dec 12 22:51:36 2000
+++ build.xml
@@ -6,11 +6,11 @@
   <property name="build.compiler" value="classic"/>
   <property name="debug" value="on"/>
   <property name="j2ee.home" value="../../j2ee/build/unix"/>
-  <property name="jaxp" value="../jaxp-1.0.1" />
+  <property name="jaxp" value="${pkgsrc.prefix}/lib/java" />
   <property name="optimize" value="true" />
-  <property name="servlet.jar" value="../jakarta-servletapi/lib/servlet.jar"/>
+  <property name="servlet.jar" value="${pkgsrc.prefix}/lib/java/servlet.jar"/>
   <property name="tomcat.build" value="../build/tomcat"/>
-  <property name="tomcat.dist" value="../dist/tomcat"/>
+  <property name="tomcat.dist" value="${pkgsrc.prefix}/tomcat"/>
 
 
   <!-- ======================== Copy static files ========================= -->
@@ -31,14 +31,19 @@
 
     <!-- Copy executables and scripts -->
     <copy todir="${tomcat.build}/bin">
-      <fileset dir="${ant.home}/bin" includes="ant*"/>
-      <fileset dir="src/shell"/>
+      <!-- <fileset dir="${ant.home}/bin" includes="ant*"/> -->
+      <fileset dir="src/shell" excludes="*.bat"/>
     </copy>
 
     <!-- Copy configuation files -->
     <copy todir="${tomcat.build}/conf">
       <fileset dir="src/etc"/>
+      <!-- <mapper type="glob" from="*.xml" to="*.xml.default"/> -->
     </copy>
+    <move todir="${tomcat.build}/conf/">
+      <fileset dir="${tomcat.build}/conf/" includes="jni_server.xml,server.xml,tomcat.policy,tomcat-users.xml,web.xml,workers.properties"/>
+      <mapper type="glob" from="*" to="*.default"/>
+    </move>
     <copy tofile="${tomcat.build}/conf/build.xml"
             file="build.xml"/>
 
@@ -49,14 +54,14 @@
     <copy tofile="${tomcat.build}/LICENSE" file="LICENSE"/>
 
     <!-- Copy library JAR files -->
-    <copy tofile="${tomcat.build}/lib/ant.jar"
-            file="${ant.home}/lib/ant.jar"/>
-    <copy tofile="${tomcat.build}/lib/servlet.jar"
-            file="${servlet.jar}"/>
-    <copy tofile="${tomcat.build}/lib/jaxp.jar"
-            file="${jaxp}/jaxp.jar"/>
-    <copy tofile="${tomcat.build}/lib/parser.jar"
-            file="${jaxp}/parser.jar"/>
+    <!-- <copy tofile="${tomcat.build}/lib/ant.jar"
+            file="${ant.home}/lib/java/ant.jar"/> -->
+    <!-- <copy tofile="${tomcat.build}/lib/servlet.jar"
+            file="${servlet.jar}"/> -->
+    <!-- <copy tofile="${tomcat.build}/lib/jaxp.jar"
+            file="${jaxp}/jaxp.jar"/> -->
+    <!-- <copy tofile="${tomcat.build}/lib/parser.jar"
+            file="${jaxp}/parser.jar"/> -->
 
     <!-- Copy golden files for the tests webapp -->
     <copy todir="${tomcat.build}/lib/test/Golden">
@@ -65,9 +70,9 @@
 
     <!-- Fixups for line endings and executable permissions -->
     <fixcrlf srcdir="${tomcat.build}" includes="**/*.sh" cr="remove"/>
-    <fixcrlf srcdir="${tomcat.build}" includes="**/*.bat" cr="add"/>
-    <chmod perm="+x" file="${tomcat.build}/bin/ant"/>
-    <chmod perm="+x" file="${tomcat.build}/bin/antRun"/>
+    <!-- <fixcrlf srcdir="${tomcat.build}" includes="**/*.bat" cr="add"/> -->
+    <!-- <chmod perm="+x" file="${tomcat.build}/bin/ant"/> -->
+    <!-- <chmod perm="+x" file="${tomcat.build}/bin/antRun"/> -->
     <chmod perm="+x" file="${tomcat.build}/bin/jspc.sh"/>
     <chmod perm="+x" file="${tomcat.build}/bin/startup.sh"/>
     <chmod perm="+x" file="${tomcat.build}/bin/shutdown.sh"/>
@@ -81,8 +86,10 @@
   <target name="tomcat" depends="prepare">
 
     <!-- Determine availability of optional components -->
+    <!-- No JSSE yet
     <available property="jsse.present" 
                classname="com.sun.net.ssl.internal.ssl.Provider" />
+    -->
     <available property="jdk12.present"
                classname="java.security.PrivilegedAction" />
 
@@ -104,8 +111,10 @@
                     unless="jdk12.present"/>
            <exclude name="**/AdaptiveClassLoader12.java" 
                     unless="jdk12.present"/>
+           <exclude name="**/EmbededTomcat.java" 
+                    unless="jsse.present"/>
            <exclude name="**/SSLSocketFactory.java"
-                    unless="jsse.present" />
+                    unless="jsse.present"/>
     </javac>
 
     <!-- Copy the corresponding resource files -->
@@ -202,8 +211,8 @@
     </copy>
 
     <!-- Fixups for executable permissions -->
-    <chmod perm="+x" file="${tomcat.dist}/bin/ant"/>
-    <chmod perm="+x" file="${tomcat.dist}/bin/antRun"/>
+    <!-- <chmod perm="+x" file="${tomcat.dist}/bin/ant"/> -->
+    <!-- <chmod perm="+x" file="${tomcat.dist}/bin/antRun"/> -->
     <chmod perm="+x" file="${tomcat.dist}/bin/jspc.sh"/>
     <chmod perm="+x" file="${tomcat.dist}/bin/startup.sh"/>
     <chmod perm="+x" file="${tomcat.dist}/bin/shutdown.sh"/>
