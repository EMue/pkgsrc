# $NetBSD: Makefile,v 1.6 2001/03/14 00:10:00 jlam Exp $

.include "../../www/php4/Makefile.module"

MODNAME=		imap
CATEGORIES+=		mail
PHP_PKG_VERS=		nb2

COMMENT=		PHP4 extension for IMAP (Internet Mailbox Access Protocol)

# We want something like:
# BUILD_DEPENDS+=	imap-uw>=2000.0.3nb1:../../mail/imap-uw
#
BUILD_DEPENDS+=		${CCLIENT_PIC_LIB}:../../mail/imap-uw

CCLIENT_PIC_LIB=	${LOCALBASE}/lib/libc-client_pic.a

CONFIGURE_ARGS+=	--with-${MODNAME}=shared,${LOCALBASE}
CONFIGURE_ARGS+=	--with-${MODNAME}-ssl=shared,${SSLBASE}

USE_SSL=		# defined

MAKE_ENV+=		LTLIBRARY_OBJECTS_X="${CCLIENT_PIC_LOBJS}"

pre-build:
	${MKDIR} ${WRKSRC}/ext/imap/.libs;				\
	cd ${WRKSRC}/ext/imap/.libs;					\
	${AR} x ${CCLIENT_PIC_LIB}
	cd ${WRKSRC}/ext/imap;						\
	for file in ${CCLIENT_PIC_OBJS}; do				\
		base=`basename $${file} .o`;				\
		${RM} -f $${base}.lo;					\
		( ${ECHO} "#";						\
		  ${ECHO} "# Generated by libtool";			\
		  ${ECHO} "#";						\
		  ${ECHO} "pic_object=.libs/$${file}";			\
		  ${ECHO} "non_pic_object=.libs/$${file}";		\
		) > $${base}.lo;					\
		${LN} -sf $${base}.lo $${base}.slo;			\
	done

.include "../../mk/bsd.pkg.mk"

.if exists(${CCLIENT_PIC_LIB}) && !defined(CCLIENT_PIC_OBJS)
CCLIENT_PIC_OBJS!=	${AR} t ${CCLIENT_PIC_LIB}
CCLIENT_PIC_LOBJS=	${CCLIENT_PIC_OBJS:S/.o/.lo/g}
.endif
