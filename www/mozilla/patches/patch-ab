$NetBSD: patch-ab,v 1.9 2000/08/16 21:23:49 tron Exp $

--- configure.in.orig	Wed Jul 19 21:52:58 2000
+++ configure.in	Wed Aug 16 22:16:56 2000
@@ -344,8 +344,6 @@
 TARGET_MD_ARCH=unix
 DIRENT_INO=d_ino
 NEED_BASE_DLL_NAME_ALSO=
-SHLIB_LDSTARTFILE=
-SHLIB_LDENDFILE=
 
 MOZ_JPEG_CFLAGS=
 MOZ_JPEG_LIBS='-L$(DIST)/lib -ljpeg'
@@ -678,31 +676,24 @@
     if $CC -E - -dM </dev/null | grep __ELF__ >/dev/null; then
         DLL_SUFFIX=".so"
         DSO_PIC_CFLAGS='-fPIC -DPIC'
-        DSO_LDOPTS='-x -shared -soname lib$(LIBRARY_NAME)$(DLL_SUFFIX)'
-        SHLIB_LDSTARTFILE=/usr/lib/crtbeginS.o
-        SHLIB_LDENDFILE=/usr/lib/crtendS.o
+        DSO_LDOPTS='-shared -Wl,-soname,lib$(LIBRARY_NAME)$(DLL_SUFFIX)'
     else
     	DSO_PIC_CFLAGS='-fPIC -DPIC'
     	DLL_SUFFIX=".so.1.0"
-    	DSO_LDOPTS='-x -shared'
-    	SHLIB_LDSTARTFILE=/usr/lib/c++rt0.o
+    	DSO_LDOPTS='-shared'
     fi
     # At least for 1.3 and up, ld supports this, despite the test failing above.
-    MKSHLIB_FORCE_ALL='--whole-archive'
-    MKSHLIB_UNFORCE_ALL='--no-whole-archive'
+    MKSHLIB_FORCE_ALL='-Wl,--whole-archive'
+    MKSHLIB_UNFORCE_ALL='-Wl,--no-whole-archive'
     case $OS_TEST in
 	alpha)
 		dnl NetBSD/alpha can't find a shared lib
 		dnl (.so.1.0) unless there's a .so as well.
 		NEED_BASE_DLL_NAME_ALSO=1
 		;;
-	*86)
-		MKSHLIB='$(LD) $(DSO_LDOPTS) -o $@'
-		MKCSHLIB='$(LD) $(DSO_LDOPTS) -o $@'
-		;;
     esac
     if test "$LIBRUNPATH"; then
-	DSO_LDOPTS="-R$LIBRUNPATH $DSO_LDOPTS"
+	DSO_LDOPTS="-Wl,-R$LIBRUNPATH $DSO_LDOPTS"
     fi
     ;;
 
@@ -954,8 +945,6 @@
 
 dnl See above (netbsd)
 AC_SUBST(NEED_BASE_DLL_NAME_ALSO)
-AC_SUBST(SHLIB_LDSTARTFILE)
-AC_SUBST(SHLIB_LDENDFILE)
 
 dnl Only one oddball right now (QNX), but this gives us flexibility
 dnl if any other platforms need to override this in the future.
@@ -1165,12 +1154,6 @@
     AM_PATH_GTK($GTK_VERSION,,
       AC_MSG_ERROR(Test for GTK failed.))
 
-case "$target" in
-i386-*-netbsd*)
-	GTK_LIBS=`echo $GTK_LIBS | sed -e 's/-Wl,//g'`
-	;;
-esac
-
 dnl ========================================================
 dnl =							   =
 dnl = --with-java-supplement				   =
@@ -1653,13 +1636,6 @@
 AC_SUBST(GLIB_CFLAGS)
 AC_SUBST(GLIB_LIBS)
 
-case "$target" in
-i386-*-netbsd*)
-	GLIB_LIBS=`echo $GLIB_LIBS | sed -e 's/-Wl,//g'`
-	LIBIDL_LIBS=`echo $LIBIDL_LIBS | sed -e 's/-Wl,//g'`
-	;;
-esac
-
 dnl Checks for typedefs, structures, and compiler characteristics.
 dnl ========================================================
 AC_C_CONST
@@ -1972,6 +1948,9 @@
 				CXXFLAGS="$CXXFLAGS -mt" 
 			fi
 			;;
+	*-*-netbsd*)
+		USE_PTHREADS=
+		_PTHREAD_LDFLAGS=
 	esac
 	AC_MSG_RESULT($ac_cv_have_dash_pthread)
 fi
