$NetBSD: patch-ar,v 1.3 2001/06/09 04:13:26 taya Exp $

diff -ru ../Orig/mozilla/nsprpub/configure.in ./nsprpub/configure.in
--- ../Orig/mozilla/nsprpub/configure.in	Tue May 22 23:15:35 2001
+++ ./nsprpub/configure.in	Sat Jun  9 01:44:04 2001
@@ -1121,27 +1121,30 @@
     AC_DEFINE(XP_UNIX)
     AC_DEFINE(NETBSD)
     AC_DEFINE(HAVE_BSD_FLOCK)
+    USE_NSPR_THREADS=1
+    MDCPUCFG_H=_netbsd.cfg
+    PR_MD_CSRCS=netbsd.c
+
+    DSO_CFLAGS='-fPIC -DPIC'
+    CFLAGS="$CFLAGS -ansi -Wall -pipe"
+    CXXFLAGS="$CXXFLAGS -ansi -Wall -pipe"
+    MKSHLIB='$(CC) -o $@ $(DSO_LDOPTS)'
+
     if test -z "$OBJECT_FMT"; then
         if echo __ELF__ | ${CC-cc} -E - | grep -q __ELF__ 2>/dev/null; then
-            OBJECT_FMT=a.out;
+            OBJECT_FMT=a.out
+            DLL_SUFFIX=so.1.0
+            DSO_LDOPTS='-shared'
         else
             OBJECT_FMT=ELF
+            DLL_SUFFIX=so
+            DSO_LDOPTS='-shared -Wl,-soname,$(notdir $@)'
         fi
     fi
-    if test "$OBJECT_FMT" = "ELF"; then
-        DLL_SUFFIX=so
-    else
-        DLL_SUFFIX=so.1.0
-    fi
-    CFLAGS="$CFLAGS -ansi -Wall -pipe"
-    CXXFLAGS="$CXXFLAGS -ansi -Wall -pipe"
-    DSO_CFLAGS='-fPIC -DPIC'
-    DSO_LDOPTS='-x -shared'
+
     if test "$LIBRUNPATH"; then
-        DSO_LDOPTS="$DSO_LDOPTS -R$(LIBRUNPATH)"
+        DSO_LDOPTS="$DSO_LDOPTS -Wl,-R$LIBRUNPATH"
     fi
-    MDCPUCFG_H=_netbsd.cfg
-    PR_MD_CSRCS=netbsd.c
     ;;
 
 mips-sony-newsos*)
@@ -1869,11 +1872,6 @@
     _PTHREAD_LDFLAGS=
     USE_USER_PTHREADS=
     ;;
-*-netbsd*)
-    if test -z "$USE_PTHREADS"; then
-        OS_LIBS="$OS_LIBS -lc"
-    fi
-    ;;    
 *-solaris*)
     if test -n "$USE_NATIVE_THREADS"; then
         AC_DEFINE(_PR_GLOBAL_THREADS_ONLY)
