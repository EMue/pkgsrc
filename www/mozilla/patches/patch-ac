$NetBSD: patch-ac,v 1.13 2000/10/30 17:03:38 mycroft Exp $

--- nsprpub/config/NetBSD.mk.orig	Thu Jul  6 21:04:45 2000
+++ nsprpub/config/NetBSD.mk	Mon Oct 30 17:01:51 2000
@@ -52,16 +52,23 @@
 DLL_SUFFIX		= so
 else
 DLL_SUFFIX		= so.1.0
+# XXX work around a bug in the a.out ld(1).
+OS_LIBS			=
 endif
 
 DSO_CFLAGS		= -fPIC -DPIC
 DSO_LDFLAGS		=
-DSO_LDOPTS		= -x -shared
+DSO_LDOPTS		= -shared
+ifeq ($(OBJECT_FMT),ELF)
+DSO_LDOPTS		+=-Wl,-soname,lib$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
+endif
 
 ifdef LIBRUNPATH
-DSO_LDOPTS		+= -R$(LIBRUNPATH)
+#DSO_LDOPTS		+= -R$(LIBRUNPATH)
+DSO_LDOPTS		+= -Wl,-R$(LIBRUNPATH)
 endif
 
-MKSHLIB			= $(LD) $(DSO_LDOPTS)
+#MKSHLIB			= $(LD) $(DSO_LDOPTS)
+MKSHLIB			= $(CC) $(DSO_LDOPTS)
 
 G++INCLUDES		= -I/usr/include/g++
