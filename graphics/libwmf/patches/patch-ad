$NetBSD: patch-ad,v 1.1 2000/09/10 20:31:34 wiz Exp $

--- configure.orig	Thu Dec 16 16:22:34 1999
+++ configure
@@ -1216,7 +1216,7 @@
 
   # It would also be nice to do this for all -L options, not just this one.
   if test -n "$x_libraries"; then
-    X_LIBS="$X_LIBS -L$x_libraries"
+    X_LIBS="$X_LIBS -L$x_libraries -Wl,-R$x_libraries"
     # For Solaris; some versions of Sun CC require a space after -R and
     # others require no space.  Words are not sufficient . . . .
     case "`(uname -sr) 2>/dev/null`" in
@@ -1822,7 +1822,7 @@
  _SAVE_LDFLAGS=$LDFLAGS
 
 if test "$TTF_DIR" != "" ; then
-CFLAGS="-I${TTF_DIR}/include $CFLAGS"
+CFLAGS="-I${TTF_DIR}/include/freetype $CFLAGS"
 LDFLAGS="-L${TTF_DIR}/lib $LDFLAGS"
 fi
 
@@ -1857,7 +1857,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lttf  $LIBS"
+LIBS="-lttf -lintl $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 1863 "configure"
 #include "confdefs.h"
@@ -1885,65 +1885,25 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  TTF_LIBS="-lttf"
-else
-  echo "$ac_t""no" 1>&6
-echo $ac_n "checking for TT_Done_FreeType in -lttf""... $ac_c" 1>&6
-echo "configure:1893: checking for TT_Done_FreeType in -lttf" >&5
-ac_lib_var=`echo ttf'_'TT_Done_FreeType | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-lttf -lnsl $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 1901 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char TT_Done_FreeType();
-
-int main() {
-TT_Done_FreeType()
-; return 0; }
-EOF
-if { (eval echo configure:1912: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
-
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-  TTF_LIBS="-lttf -lnsl"
+  TTF_LIBS="-lttf -lintl"
 else
   echo "$ac_t""no" 1>&6
 no_ttf=yes
 fi
 
-fi
-
 else
     no_ttf=yes
 fi
 
 if  test -n "${TTF_DIR}" && test -d "${TTF_DIR}" && test "$SYSTEM_TTF" = 1 ; then
-    TTF_CFLAGS="-I${TTF_DIR}/include"
+    TTF_CFLAGS="-I${TTF_DIR}/include/freetype"
     TTF_LIBS="-L${TTF_DIR}/lib ${TTF_LIBS}"
 fi
 
 if test "x$no_ttf" = xyes; then
     if test "$TTF_DIR" != "" ; then
-    CFLAGS="-I${TTF_DIR} $CFLAGS"
-    LDFLAGS="-L${TTF_DIR} $LDFLAGS"
+    CFLAGS="-I${TTF_DIR}/include/freetype $CFLAGS"
+    LDFLAGS="-L${TTF_DIR}/lib $LDFLAGS"
     fi
 
     if test "$TTF_DIR" = no; then
@@ -1973,7 +1933,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lttf  $LIBS"
+LIBS="-lttf -lintl $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 1985 "configure"
 #include "confdefs.h"
@@ -2007,59 +1967,19 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  TTF_LIBS="-lttf"
-else
-  echo "$ac_t""no" 1>&6
-echo $ac_n "checking for TT_Done_FreeType in -lttf""... $ac_c" 1>&6
-echo "configure:2015: checking for TT_Done_FreeType in -lttf" >&5
-ac_lib_var=`echo ttf'_'TT_Done_FreeType | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-lttf -lnsl $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 2023 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char TT_Done_FreeType();
-
-int main() {
-TT_Done_FreeType()
-; return 0; }
-EOF
-if { (eval echo configure:2034: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
-
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-  TTF_LIBS="-lttf -lnsl"
+  TTF_LIBS="-lttf -lintl"
 else
   echo "$ac_t""no" 1>&6
 no_ttf=yes
 fi
 
-fi
-
     else
         no_ttf=yes
     fi
 
 if  test -n "${TTF_DIR}" && test -d "${TTF_DIR}" && test "$SYSTEM_TTF" = 1 ; then
-    TTF_CFLAGS="-I${TTF_DIR}"
-    TTF_LIBS="-L${TTF_DIR} ${TTF_LIBS}"
+    TTF_CFLAGS="-I${TTF_DIR}/include/freetype"
+    TTF_LIBS="-L${TTF_DIR}/lib ${TTF_LIBS}"
 fi
 
 fi
@@ -2361,7 +2281,7 @@
 
   # It would also be nice to do this for all -L options, not just this one.
   if test -n "$x_libraries"; then
-    X_LIBS="$X_LIBS -L$x_libraries"
+    X_LIBS="$X_LIBS -L$x_libraries -Wl,-R$x_libraries"
     # For Solaris; some versions of Sun CC require a space after -R and
     # others require no space.  Words are not sufficient . . . .
     case "`(uname -sr) 2>/dev/null`" in
@@ -3777,15 +3697,15 @@
 fi
 if  test "$SYSTEM_TTF" = 1 ; then
     echo $ac_n "checking for TT_Init_FreeType in -lttf""... $ac_c" 1>&6
-echo "configure:3781: checking for TT_Init_FreeType in -lttf" >&5
+echo "configure:3701: checking for TT_Init_FreeType in -lttf" >&5
 ac_lib_var=`echo ttf'_'TT_Init_FreeType | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lttf -lm $LIBS"
+LIBS="-lttf -lintl $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3789 "configure"
+#line 3709 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3811,7 +3731,7 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  TTF_LIBS="-lttf"
+  TTF_LIBS="-lttf -lintl"
 else
   echo "$ac_t""no" 1>&6
 no_ttf=yes
@@ -3822,14 +3742,14 @@
 fi
 
 if  test -n "${TTF_DIR}" && test -d "${TTF_DIR}" && test "$SYSTEM_TTF" = 1 ; then
-    TTF_CFLAGS="-I${TTF_DIR}/include"
+    TTF_CFLAGS="-I${TTF_DIR}/include/freetype"
     TTF_LIBS="-L${TTF_DIR}/lib ${TTF_LIBS}"
 fi
 
 if test "x$no_ttf" = xyes; then
     if test "$TTF_DIR" != "" ; then
-    CFLAGS="-I${TTF_DIR} $CFLAGS"
-    LDFLAGS="-L${TTF_DIR} $LDFLAGS"
+    CFLAGS="-I${TTF_DIR}/include/freetype $CFLAGS"
+    LDFLAGS="-L${TTF_DIR}/lib $LDFLAGS"
     fi
 
     if test "$TTF_DIR" = no; then
@@ -3859,15 +3779,15 @@
     fi
     if  test "$SYSTEM_TTF" = 1 ; then
         echo $ac_n "checking for TT_Init_FreeType in -lttf""... $ac_c" 1>&6
-echo "configure:3863: checking for TT_Init_FreeType in -lttf" >&5
+echo "configure:3783: checking for TT_Init_FreeType in -lttf" >&5
 ac_lib_var=`echo ttf'_'TT_Init_FreeType | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lttf -lm $LIBS"
+LIBS="-lttf -lintl $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3871 "configure"
+#line 3791 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3893,7 +3813,7 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  TTF_LIBS="-lttf"
+  TTF_LIBS="-lttf -lintl"
 else
   echo "$ac_t""no" 1>&6
 no_ttf=yes
@@ -3905,8 +3825,8 @@
 
 
 if  test -n "${TTF_DIR}" && test -d "${TTF_DIR}" && test "$SYSTEM_TTF" = 1 ; then
-    TTF_CFLAGS="-I${TTF_DIR}"
-    TTF_LIBS="-L${TTF_DIR} ${TTF_LIBS}"
+    TTF_CFLAGS="-I${TTF_DIR}/include/freetype"
+    TTF_LIBS="-L${TTF_DIR}/lib ${TTF_LIBS}"
 fi
 
 fi
