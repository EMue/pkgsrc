$NetBSD: patch-ac,v 1.6 1999/07/24 21:01:18 tron Exp $

--- Makefile.in.orig	Thu Sep 25 20:32:45 1997
+++ Makefile.in	Sat Jul 24 22:40:29 1999
@@ -29,7 +29,7 @@
 # Directory in which to install the library of Tix scripts and demos
 # (note: you can set the TIX_LIBRARY environment variable at run-time to
 # override the compiled-in location):
-TIX_LIBRARY =	$(prefix)/lib/tix$(TIX_VERSION)
+TIX_LIBRARY =	$(prefix)/share/tix$(TIX_VERSION)
 
 # Directory in which to install the archive libtix.a:
 LIB_DIR =	$(exec_prefix)/lib
@@ -70,16 +70,16 @@
 TK_GENERIC_DIR  = $(TK_SRC_DIR)/generic
 
 # Libraries to use when linking:
-LIBS = @ITK_BUILD_LIB_SPEC@ @ITCL_BUILD_LIB_SPEC@ \
-    @TK_BUILD_LIB_SPEC@ @TCL_BUILD_LIB_SPEC@ @TK_LIBS@
+LIBS = @ITK_LIB_SPEC@ @ITCL_LIB_SPEC@ \
+    @TK_LIB_SPEC@ @TCL_LIB_SPEC@ @TK_LIBS@
 
 # Libraries for building a stand-alone Tclsh.
 #
-LIBS_TCLONLY = @TCL_BUILD_LIB_SPEC@ @TCL_LIBS@
+LIBS_TCLONLY = @TCL_LIB_SPEC@ @TCL_LIBS@
 
-RUN_TCLSH	= TCL_LIBRARY=$(TCL_SRC_DIR)/library \
-		  TK_LIBRARY=$(TK_SRC_DIR)/library \
-	          $(TCL_SRC_DIR)/unix/tclsh
+RUN_TCLSH	= TCL_LIBRARY=$(TCL_SRC_DIR)/../../lib/tcl8.0 \
+		  TK_LIBRARY=$(TK_SRC_DIR)/../../lib/tk8.0 \
+	          $(TCL_SRC_DIR)/../../bin/tclsh8.0
 
 
 #----------------------------------------------------------------
@@ -88,7 +88,7 @@
 # modify any of this stuff by hand.
 #----------------------------------------------------------------
 
-CC		 = @CC@
+CC		 = $(LIBTOOL) @CC@
 
 SHLIB_CFLAGS	 = @SHLIB_CFLAGS@
 SHLIB_LD	 = @SHLIB_LD@
@@ -105,7 +105,7 @@
 AC_FLAGS	 = @DEFS@ @TIX_DEFS@
 RANLIB		 = @RANLIB@
 INSTALL		 = @TIX_SRC_DIR@/install.sh -c
-INSTALL_PROGRAM  = @INSTALL_PROGRAM@
+INSTALL_PROGRAM  = $(LIBTOOL) @INSTALL_PROGRAM@
 INSTALL_DATA	 = @INSTALL_DATA@
 
 TIX_LIB_FILE     = @TIX_LIB_FILE@
@@ -133,7 +133,7 @@
     -I$(TCL_SRC_DIR)/unix -I$(TK_GENERIC_DIR) -I$(TK_SRC_DIR)/unix \
     $(ITCL_CFLAGS) \
     -I$(GENERIC_DIR) -I$(UNIX_DIR) $(TK_XINCLUDES) $(TIX_SHLIB_CFLAGS) \
-    -DTIX_LIBRARY=\"${TIX_LIBRARY}\"
+    -DTIX_LIBRARY=\"$(TIX_LIBRARY)\"
 
 #----------------------------------------------------------------
 # The information below should be usable as is. You shouldn't need
@@ -211,29 +211,29 @@
 # scripts of TK must be included in the fixed order.
 #----------------------------------------------------------------------
 
-TCL_SCRIPTS = $(TCL_SRC_DIR)/library/*.tcl
+TCL_SCRIPTS = $(TCL_SRC_DIR)/../../lib/tcl8.0/*.tcl
 
 TK_SCRIPTS = \
-    $(TK_SRC_DIR)/library/bgerror.tcl \
-    $(TK_SRC_DIR)/library/dialog.tcl \
-    $(TK_SRC_DIR)/library/focus.tcl \
-    $(TK_SRC_DIR)/library/obsolete.tcl \
-    $(TK_SRC_DIR)/library/optMenu.tcl \
-    $(TK_SRC_DIR)/library/palette.tcl \
-    $(TK_SRC_DIR)/library/tearoff.tcl \
-    $(TK_SRC_DIR)/library/clrpick.tcl \
-    $(TK_SRC_DIR)/library/comdlg.tcl \
-    $(TK_SRC_DIR)/library/msgbox.tcl \
-    $(TK_SRC_DIR)/library/tkfbox.tcl \
-    $(TK_SRC_DIR)/library/xmfbox.tcl \
-    $(SRC_DIR)/generic/tk4.2/tk.tcl \
-    $(TK_SRC_DIR)/library/button.tcl \
-    $(TK_SRC_DIR)/library/entry.tcl \
-    $(TK_SRC_DIR)/library/listbox.tcl \
-    $(TK_SRC_DIR)/library/menu.tcl \
-    $(TK_SRC_DIR)/library/scale.tcl \
-    $(TK_SRC_DIR)/library/scrlbar.tcl \
-    $(TK_SRC_DIR)/library/text.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/bgerror.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/dialog.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/focus.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/obsolete.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/optMenu.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/palette.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/tearoff.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/clrpick.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/comdlg.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/msgbox.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/tkfbox.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/xmfbox.tcl \
+    $(SRC_DIR)/generic/tk8.0/tk.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/button.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/entry.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/listbox.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/menu.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/scale.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/scrlbar.tcl \
+    $(TK_SRC_DIR)/../../lib/tk8.0/text.tcl \
     $(SRC_DIR)/generic/tk8.0/console.tcl
 
 TIX_SCRIPTS = \
@@ -241,12 +241,10 @@
     $(SRC_DIR)/library/pref/*.csc \
     $(SRC_DIR)/library/*.tcl
 
-all: $(TIX_LIB_FILE) $(TIX_EXE_FILE) @TIX_SAM_TARGETS@
+all: $(TIX_LIB_FILE:.a=.la) $(TIX_EXE_FILE) $(TIX_SAM_TARGETS:.a=.la)
 
-$(TIX_LIB_FILE): $(OBJS)
-	rm -f $(TIX_LIB_FILE)
-	@TIX_MAKE_LIB@
-	$(RANLIB) $(TIX_LIB_FILE)
+$(TIX_LIB_FILE:.a=.la): $(OBJS)
+	$(LIBTOOL) --mode=link cc -o $(.TARGET) $(OBJS:.o=.lo) -rpath $(PREFIX)/lib -version-info 1:2
 
 $(TCL_SAM_FILE): $(TCL_SAM_OBJS)
 	rm -f $(TCL_SAM_FILE)
@@ -258,14 +256,14 @@
 	@TK_MAKE_SAM@
 	$(RANLIB) $(TK_SAM_FILE)
 
-$(TIX_SAM_FILE): $(TIX_SAM_OBJS)
-	rm -f $(TIX_SAM_FILE)
-	@TIX_MAKE_SAM@
-	$(RANLIB) $(TIX_SAM_FILE)
-
-$(TIX_EXE_FILE): tixAppInit.o $(TIX_LIB_FILE)
-	$(CC) @LD_FLAGS@ tixAppInit.o @TIX_BUILD_LIB_SPEC@ $(LIBS) \
-		@TIX_LD_SEARCH_FLAGS@ -o $(TIX_EXE_FILE)
+$(TIX_SAM_FILE:.a=.la): $(TIX_SAM_OBJS)
+	$(LIBTOOL) --mode=link cc -o $(.TARGET) $(TIX_SAM_OBJS:.o=.lo) -rpath $(PREFIX)/lib -version-info 1:2
+
+RPATH=	-Wl,-R$(LOCALBASE)/lib -Wl,-R$(X11BASE)/lib
+
+$(TIX_EXE_FILE): tixAppInit.o $(TIX_LIB_FILE:.a=.la)
+	$(CC) @LD_FLAGS@ tixAppInit.o @LDFLAGS@ $(RPATH) $(LIBS) \
+		@TIX_LD_SEARCH_FLAGS@ $(TIX_LIB_FILE:.a=.la) -o $(TIX_EXE_FILE)
 
 $(TCL_SAMEXE_FILE): $(UNIX_DIR)/samAppInit.c $(TCL_SAM_FILE)
 	$(CC) $(CC_SWITCHES) @LD_FLAGS@ -DUSE_TCL $(UNIX_DIR)/samAppInit.c \
@@ -451,7 +449,7 @@
 	    ITK_LIBRARY=$(ITK_SRC_DIR)/library \
 	    IWIDGETS_LIBRARY=$(ITCL_ROOT_DIR)/$(IWIDGETS) \
 	    TIX_LIBRARY=$(SRC_DIR)/library \
-    	    LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:. \
+    	    LD_LIBRARY_PATH=$(LD_LIBRARY_PATH):. \
 	    ./$(TIX_EXE_FILE) $(SRC_DIR)/tests/Driver.tcl
 
 sa-tests: $(TIX_SAMEXE_FILE)
@@ -473,7 +471,7 @@
 		fi; \
 	    done;
 	@echo "Installing $(TIX_LIB_FILE) as $(LIB_DIR)/$(TIX_LIB_FILE)"
-	@$(INSTALL_PROGRAM) $(TIX_LIB_FILE) $(LIB_DIR)/$(TIX_LIB_FILE)
+	@$(LIBTOOL) --mode=install $(INSTALL_DATA) $(TIX_LIB_FILE:.a=.la) $(LIB_INSTALL_DIR)
 	@echo "Installing $(TIX_EXE_FILE) as $(BIN_DIR)/$(INST_EXE)"
 	@$(INSTALL_PROGRAM) $(TIX_EXE_FILE) $(BIN_DIR)/$(INST_EXE)
 
@@ -510,7 +508,7 @@
 		fi; \
 	    done;
 	@echo "Installing $(TIX_SAM_FILE) as $(LIB_DIR)/$(TIX_SAM_FILE)"
-	@$(INSTALL_PROGRAM) $(TIX_SAM_FILE) $(LIB_DIR)/$(TIX_SAM_FILE)
+	@$(LIBTOOL) --mode=install $(INSTALL_DATA) $(TIX_SAM_FILE:.a=.la) $(LIB_INSTALL_DIR)
 
 
 install: _install_
