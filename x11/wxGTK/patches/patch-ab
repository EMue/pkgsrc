$NetBSD: patch-ab,v 1.6 2001/06/18 05:02:09 jlam Exp $

--- Makefile.in.orig	Tue May 22 16:27:56 2001
+++ Makefile.in	Fri Jun 15 01:07:50 2001
@@ -19,13 +19,13 @@
 .SUFFIXES:	.o .cpp .c .cxx
 
 .c.o :
-	$(CCC) -c @DEP_INFO_FLAGS@ $(CFLAGS) $(PICFLAGS) -o $@ $<
+	${LIBTOOL} --mode=compile $(CCC)  -c @DEP_INFO_FLAGS@ $(CFLAGS) -o $@ $<
 
 .cpp.o :
-	$(CC) -c @DEP_INFO_FLAGS@ $(CPPFLAGS) $(PICFLAGS) -o $@ $<
+	${LIBTOOL} --mode=compile $(CC) -c @DEP_INFO_FLAGS@ $(CPPFLAGS) -o $@ $<
 
 .cxx.o :
-	$(CC) -c @DEP_INFO_FLAGS@ $(CPPFLAGS) $(PICFLAGS) -o $@ $<
+	${LIBTOOL} --mode=compile $(CC) -c @DEP_INFO_FLAGS@ $(CPPFLAGS) -o $@ $<
 
 ########################### Paths #################################
 
@@ -37,10 +37,6 @@
 VP4 = @top_srcdir@/src/generic
 VP5 = @top_srcdir@/src/unix
 VP6 = @top_srcdir@/src/html
-VP7 = @top_srcdir@/src/png
-VP8 = @top_srcdir@/src/jpeg
-VP9 = @top_srcdir@/src/tiff
-VP10 = @top_srcdir@/src/zlib
 VP11 = @top_srcdir@/src/iodbc
 VP12 = @top_srcdir@/src/ole
 
@@ -66,7 +62,7 @@
 # the comment at the end of the next line is needed because otherwise autoconf
 # would remove this line completely - it contains a built-in hack to remove
 # any VPATH assignment not containing ':'
-VPATH = $(VP1)@PATH_IFS@$(VP2)@PATH_IFS@$(VP3)@PATH_IFS@$(VP4)@PATH_IFS@$(VP5)@PATH_IFS@$(VP6)@PATH_IFS@$(VP7)@PATH_IFS@$(VP8)@PATH_IFS@$(VP9)@PATH_IFS@$(VP10)@PATH_IFS@$(VP11)@PATH_IFS@$(VP12)@PATH_IFS@$(VP13)@PATH_IFS@$(VP14) # ':' for autoconf
+VPATH = $(VP1)@PATH_IFS@$(VP2)@PATH_IFS@$(VP3)@PATH_IFS@$(VP4)@PATH_IFS@$(VP5)@PATH_IFS@$(VP6)@PATH_IFS@$(VP11)@PATH_IFS@$(VP12)@PATH_IFS@$(VP13)@PATH_IFS@$(VP14) # ':' for autoconf
 
 top_srcdir = @top_srcdir@
 prefix = @prefix@
@@ -95,13 +91,16 @@
 
 top_builddir = .
 
+EXTRALIBS=-lz -L@prefix@/lib -Wl,-R@prefix@/lib -ljpeg -lpng -ltiff
+
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+INSTALL_DATA_DIR = ${BSD_INSTALL_DATA_DIR}
 # my autoconf doesn't set this
-#INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
 # maybe do an additional chmod if needed?
-INSTALL_SCRIPT = @INSTALL@
+#INSTALL_SCRIPT = @INSTALL@
 transform = @program_transform_name@
 
 NORMAL_INSTALL = :
@@ -130,10 +129,6 @@
 COMMDIR  = $(WXDIR)/src/common
 HTMLDIR  = $(WXDIR)/src/html
 UNIXDIR  = $(WXDIR)/src/unix
-PNGDIR   = $(WXDIR)/src/png
-JPEGDIR  = $(WXDIR)/src/jpeg
-TIFFDIR  = $(WXDIR)/src/tiff
-ZLIBDIR  = $(WXDIR)/src/zlib
 GTKDIR   = $(WXDIR)/src/gtk
 MOTIFDIR = $(WXDIR)/src/motif
 MSWDIR   = $(WXDIR)/src/msw
@@ -184,41 +179,6 @@
 OBJECTS = @ALL_OBJECTS@
 DEPFILES = @ALL_DEPFILES@
 
-# the object files of sublibraries (we assume that they don't change [often],
-# so we don't generate these lists with tmake but embed them here)
-ZLIBOBJS    = \
-		adler32.o \
-		compress.o \
-		crc32.o \
-		gzio.o \
-		uncompr.o \
-		deflate.o \
-		trees.o \
-		zutil.o \
-		inflate.o \
-		infblock.o \
-		inftrees.o \
-		infcodes.o \
-		infutil.o \
-		inffast.o
-
-PNGOBJS     = \
-		png.o \
-		pngread.o \
-		pngrtran.o \
-		pngrutil.o \
-		pngpread.o \
-		pngtrans.o \
-		pngwrite.o \
-		pngwtran.o \
-		pngwutil.o \
-		pngerror.o \
-		pngmem.o \
-		pngwio.o \
-		pngrio.o \
-		pngget.o \
-		pngset.o
-
 FREETYPEOBJS = \
 		ftsystem.o \
 		autohint.o \
@@ -238,89 +198,6 @@
 		type1z.o \
 		winfnt.o
 
-JPEGOBJS    = \
-		jcomapi.o \
-		jutils.o \
-		jerror.o \
-		jmemmgr.o \
-		jmemnobs.o \
-		jcapimin.o \
-		jcapistd.o \
-		jctrans.o \
-		jcparam.o \
-		jdatadst.o \
-		jcinit.o \
-		jcmaster.o \
-		jcmarker.o \
-		jcmainct.o \
-		jcprepct.o \
-		jccoefct.o \
-		jccolor.o \
-		jcsample.o \
-		jchuff.o \
-		jcphuff.o \
-		jcdctmgr.o \
-		jfdctfst.o \
-		jfdctflt.o \
-		jfdctint.o \
-		jdapimin.o \
-		jdapistd.o \
-		jdtrans.o \
-		jdatasrc.o \
-		jdmaster.o \
-		jdinput.o \
-		jdmarker.o \
-		jdhuff.o \
-		jdphuff.o \
-		jdmainct.o \
-		jdcoefct.o \
-		jdpostct.o \
-		jddctmgr.o \
-		jidctfst.o \
-		jidctflt.o \
-		jidctint.o \
-		jidctred.o \
-		jdsample.o \
-		jdcolor.o \
-		jquant1.o \
-		jquant2.o \
-		jdmerge.o
-
-TIFFOBJS	= \
-		tif_aux.o \
-		tif_close.o \
-		tif_codec.o \
-		tif_compress.o \
-		tif_dir.o \
-		tif_dirinfo.o \
-		tif_dirread.o \
-		tif_dirwrite.o \
-		tif_dumpmode.o \
-		tif_error.o \
-		tif_fax3.o \
-		tif_fax3sm.o \
-		tif_getimage.o \
-		tif_jpeg.o \
-		tif_flush.o \
-		tif_lzw.o \
-		tif_luv.o \
-		tif_next.o \
-		tif_open.o \
-		tif_packbits.o \
-		tif_pixarlog.o \
-		tif_predict.o \
-		tif_print.o \
-		tif_read.o \
-		tif_swab.o \
-		tif_strip.o \
-		tif_thunder.o \
-		tif_tile.o \
-		tif_unix.o \
-		tif_version.o \
-		tif_warning.o \
-		tif_write.o \
-		tif_zip.o
-
 IODBCOBJS = \
 		catalog.o \
 		connect.o \
@@ -345,64 +222,27 @@
 
 all: @WX_ALL@
 
-@WX_LIBRARY_NAME_STATIC@:  $(OBJECTS)
-	@$(INSTALL) -d ./lib
-	$(AR) $(AROPTIONS) ./lib/$@ $(OBJECTS)
-	$(RANLIB) ./lib/$@
+CREATE_LINKS: $(top_builddir)/lib/@WX_LIBRARY_NAME@
+
+CREATE_INSTALLED_LINKS: preinstall
+
+$(top_builddir)/lib/@WX_LIBRARY_NAME@:  $(OBJECTS)
+	@$(INSTALL_DATA_DIR) ./lib
+	${LIBTOOL} --mode=link cc -o $(top_builddir)/lib/@WX_LIBRARY_NAME@  ${OBJECTS:.o=.lo} ${EXTRALIBS} -rpath ${PREFIX}/lib -version-info 0:1
 
 @WX_LIBRARY_NAME_STATIC_GL@:  glcanvas.o
-	@$(INSTALL) -d ./lib
+	@$(INSTALL_DATA_DIR) ./lib
 	$(AR) $(AROPTIONS) ./lib/$@ glcanvas.o
 	$(RANLIB) ./lib/$@
 
-@WX_LIBRARY_NAME_SHARED@:  $(OBJECTS)
-	@$(INSTALL) -d ./lib
-	$(SHARED_LD) ./lib/$@ $(BURNT_LIBRARY_NAME) $(OBJECTS) $(EXTRALIBS)
-
 @WX_LIBRARY_NAME_SHARED_GL@:  glcanvas.o
-	@$(INSTALL) -d ./lib
+	@$(INSTALL_DATA_DIR) ./lib
 	$(SHARED_LD) ./lib/$@ $(BURNT_LIBRARY_NAME_GL) glcanvas.o $(EXTRALIBS)
 
-CREATE_LINKS: @WX_LIBRARY_NAME_SHARED@
-	@$(RM) ./lib/@WX_LIBRARY_LINK1@
-	@$(RM) ./lib/@WX_LIBRARY_LINK2@
-	@$(RM) ./lib/@WX_LIBRARY_LINK3@
-	cd lib \
-		&& $(LN_S) @WX_TARGET_LIBRARY@ @WX_LIBRARY_LINK1@ \
-		&& $(LN_S) @WX_TARGET_LIBRARY@ @WX_LIBRARY_LINK2@ \
-		&& $(LN_S) @WX_TARGET_LIBRARY@ @WX_LIBRARY_LINK3@
-
-CREATE_LINKS_GL: @WX_LIBRARY_NAME_SHARED_GL@
-	@$(RM) ./lib/@WX_LIBRARY_LINK1_GL@
-	@$(RM) ./lib/@WX_LIBRARY_LINK2_GL@
-	@$(RM) ./lib/@WX_LIBRARY_LINK3_GL@
-	cd lib \
-		&& $(LN_S) @WX_TARGET_LIBRARY_GL@ @WX_LIBRARY_LINK1_GL@ \
-		&& $(LN_S) @WX_TARGET_LIBRARY_GL@ @WX_LIBRARY_LINK2_GL@ \
-		&& $(LN_S) @WX_TARGET_LIBRARY_GL@ @WX_LIBRARY_LINK3_GL@
-
-CREATE_INSTALLED_LINKS: preinstall
-	$(RM) $(libdir)/@WX_LIBRARY_LINK1@
-	$(RM) $(libdir)/@WX_LIBRARY_LINK2@
-	$(RM) $(libdir)/@WX_LIBRARY_LINK3@
-	cd $(libdir) \
-		&& $(LN_S) @WX_LIBRARY_NAME_SHARED@ @WX_LIBRARY_LINK1@ \
-		&& $(LN_S) @WX_LIBRARY_NAME_SHARED@ @WX_LIBRARY_LINK2@ \
-		&& $(LN_S) @WX_LIBRARY_NAME_SHARED@ @WX_LIBRARY_LINK3@
-
-CREATE_INSTALLED_LINKS_GL: preinstall_gl
-	$(RM) $(libdir)/@WX_LIBRARY_LINK1_GL@
-	$(RM) $(libdir)/@WX_LIBRARY_LINK2_GL@
-	$(RM) $(libdir)/@WX_LIBRARY_LINK3_GL@
-	cd $(libdir) \
-		&& $(LN_S) @WX_LIBRARY_NAME_SHARED_GL@ @WX_LIBRARY_LINK1_GL@ \
-		&& $(LN_S) @WX_LIBRARY_NAME_SHARED_GL@ @WX_LIBRARY_LINK2_GL@ \
-		&& $(LN_S) @WX_LIBRARY_NAME_SHARED_GL@ @WX_LIBRARY_LINK3_GL@
-
 $(OBJECTS):	$(WXDIR)/include/wx/defs.h $(WXDIR)/include/wx/object.h
 
 parser.o:    parser.c lexer.c
-	$(CCLEX) -c $(CFLAGS) $(PICFLAGS) -o $@ parser.c
+	${LIBTOOL} --mode=compile $(CCLEX) -c $(CFLAGS) -o $@ parser.c
 
 parser.c:	$(COMMDIR)/parser.y lexer.c
 	$(YACC) $(COMMDIR)/parser.y
@@ -425,49 +265,41 @@
 -include $(DEPFILES)
 
 afminstall: preinstall
-	$(INSTALL) -d $(datadir)
-	$(INSTALL) -d $(datadir)/wx
-	$(INSTALL) -d $(datadir)/wx/afm
-	$(INSTALL) -d $(datadir)/wx/gs_afm
+	$(INSTALL_DATA_DIR) $(datadir)/wx
+	$(INSTALL_DATA_DIR) $(datadir)/wx/afm
+	$(INSTALL_DATA_DIR) $(datadir)/wx/gs_afm
 	$(INSTALL_DATA) $(top_srcdir)/misc/afm/*.afm $(datadir)/wx/afm
 	$(INSTALL_DATA) $(top_srcdir)/misc/gs_afm/*.afm $(datadir)/wx/gs_afm
 
 # this is the real install target: copies the library, wx-config and the
 # headers to the installation directory
-preinstall: $(top_builddir)/lib/@WX_TARGET_LIBRARY@ $(top_builddir)/wx@TOOLKIT_NAME@-config
+preinstall: $(top_builddir)/lib/@WX_LIBRARY_NAME@ $(top_builddir)/wx@TOOLKIT_NAME@-config
 	@echo " "
 	@echo " Installing wxWindows..."
 	@echo " "
 
-	$(INSTALL) -d $(prefix)
-	$(INSTALL) -d $(bindir)
-	$(INSTALL) -d $(libdir)
-
 	$(INSTALL_SCRIPT) $(top_builddir)/wx@TOOLKIT_NAME@-config $(bindir)/wx@TOOLKIT_NAME@-config
 	cd $(bindir) && rm -f wx-config && $(LN_S) wx@TOOLKIT_NAME@-config wx-config
-	$(INSTALL_PROGRAM) $(top_builddir)/lib/@WX_TARGET_LIBRARY@ $(libdir)/@WX_TARGET_LIBRARY@
+	${LIBTOOL} --mode=install ${INSTALL_DATA} $(top_builddir)/lib/@WX_LIBRARY_NAME@ ${libdir}
 
-	$(INSTALL) -d $(libdir)/wx
-	$(INSTALL) -d $(libdir)/wx/include
-	$(INSTALL) -d $(libdir)/wx/include/wx
-	$(INSTALL) -d $(libdir)/wx/include/wx/@TOOLKIT_NAME@
+	$(INSTALL_DATA_DIR) $(libdir)/wx
+	$(INSTALL_DATA_DIR) $(libdir)/wx/include
+	$(INSTALL_DATA_DIR) $(libdir)/wx/include/wx
+	$(INSTALL_DATA_DIR) $(libdir)/wx/include/wx/@TOOLKIT_NAME@
 	$(INSTALL_DATA) $(top_builddir)/include/wx/@TOOLKIT_DIR@/setup.h $(libdir)/wx/include/wx/@TOOLKIT_NAME@/setup.h
 
-	$(INSTALL) -d $(includedir)/wx
-	@if test "$(USE_GUI)" = 1; then $(INSTALL) -d $(includedir)/wx/@TOOLKIT_DIR@; fi
-	@if test "$(USE_GUI)" = 1; then $(INSTALL) -d $(includedir)/wx/html; fi
-	@if test "$(USE_GUI)" = 1; then $(INSTALL) -d $(includedir)/wx/generic; fi
-	$(INSTALL) -d $(includedir)/wx/protocol
-	$(INSTALL) -d $(includedir)/wx/unix
+	$(INSTALL_DATA_DIR) $(includedir)/wx
+	@if test "$(USE_GUI)" = 1; then $(INSTALL_DATA_DIR) $(includedir)/wx/@TOOLKIT_DIR@; fi
+	@if test "$(USE_GUI)" = 1; then $(INSTALL_DATA_DIR) $(includedir)/wx/html; fi
+	@if test "$(USE_GUI)" = 1; then $(INSTALL_DATA_DIR) $(includedir)/wx/generic; fi
+	$(INSTALL_DATA_DIR) $(includedir)/wx/protocol
+	$(INSTALL_DATA_DIR) $(includedir)/wx/unix
 	@list='$(HEADERS)'; for p in $$list; do \
 	  $(INSTALL_DATA) $(top_srcdir)/include/wx/$$p $(includedir)/wx/$$p; \
 	  echo "$(INSTALL_DATA) $(top_srcdir)/include/wx/$$p $(includedir)/wx/$$p"; \
 	done
 
-	$(INSTALL) -d $(localedir)
 	@for p in $(WX_LINGUAS); do \
-	  $(INSTALL) -d $(localedir)/$$p; \
-	  $(INSTALL) -d $(localedir)/$$p/LC_MESSAGES; \
 	  $(INSTALL_DATA) $(top_srcdir)/locale/$$p.mo $(localedir)/$$p/LC_MESSAGES/wxstd.mo; \
 	  echo "$(INSTALL_DATA) $(top_srcdir)/locale/$$p.mo $(localedir)/$$p/LC_MESSAGES/wxstd.mo"; \
 	done
@@ -476,7 +308,6 @@
 	@echo " "
 	@echo " Installing wxWindows OpenGl add-on..."
 	@echo " "
-	$(INSTALL) -d $(libdir)
 	$(INSTALL_PROGRAM) $(top_builddir)/lib/@WX_TARGET_LIBRARY_GL@ $(libdir)/@WX_TARGET_LIBRARY_GL@
 
 install: @AFMINSTALL@ @WX_ALL_INSTALLED@
@@ -565,10 +396,6 @@
 	cp $(WXDIR)/lib/vms_gtk.opt $(DISTDIR)/lib
 	mkdir $(DISTDIR)/src
 	mkdir $(DISTDIR)/src/zlib
-	cp $(ZLIBDIR)/*.h $(DISTDIR)/src/zlib
-	cp $(ZLIBDIR)/*.c $(DISTDIR)/src/zlib
-	cp $(ZLIBDIR)/README $(DISTDIR)/src/zlib
-	cp $(ZLIBDIR)/*.mms $(DISTDIR)/src/zlib
 
 # this target is the common part of distribution script for all GUI toolkits,
 # but is not used when building wxBase distribution
@@ -600,7 +427,6 @@
 	mkdir $(DISTDIR)/src/html/bitmaps
 	mkdir $(DISTDIR)/src/$(TOOLKITDIR)
 	mkdir $(DISTDIR)/src/png
-	mkdir $(DISTDIR)/src/jpeg
 	mkdir $(DISTDIR)/src/tiff
 	mkdir $(DISTDIR)/src/iodbc
 	mkdir $(DISTDIR)/src/unix
@@ -623,9 +449,6 @@
 	cp $(PNGDIR)/*.h $(DISTDIR)/src/png
 	cp $(PNGDIR)/*.c $(DISTDIR)/src/png
 	cp $(PNGDIR)/README $(DISTDIR)/src/png
-	cp $(JPEGDIR)/*.h $(DISTDIR)/src/jpeg
-	cp $(JPEGDIR)/*.c $(DISTDIR)/src/jpeg
-	cp $(JPEGDIR)/README $(DISTDIR)/src/jpeg
 	cp $(TIFFDIR)/*.h $(DISTDIR)/src/tiff
 	cp $(TIFFDIR)/*.c $(DISTDIR)/src/tiff
 	cp $(TIFFDIR)/README $(DISTDIR)/src/tiff
