$NetBSD: patch-aa,v 1.3 2001/01/31 22:47:53 jlam Exp $

--- configure.in.orig	Thu Jul 20 22:35:01 2000
+++ configure.in
@@ -65,9 +65,12 @@
 
 dnl check for -R, etc. switch
 CMU_GUESS_RUNPATH_SWITCH
-dnl let's just link against local.  otherwise we never find anything useful.
-CPPFLAGS="-I/usr/local/include ${CPPFLAGS}"
-CMU_ADD_LIBPATH("/usr/local/lib")
+
+AC_PATH_PROG(SED, sed, no)
+if test "$SED" = "no"; then
+  AC_ERROR([sed is required to build sasl-config])
+fi
+AC_SUBST(SED)
 
 AM_DISABLE_STATIC
 
@@ -352,8 +355,11 @@
     CPPFLAGS="$CPPFLAGS -I${with_des}/include"
     LDFLAGS="$LDFLAGS -L${with_des}/lib"
   fi
-  AC_CHECK_LIB(des, des_pcbc_encrypt, [LIB_DES="-ldes";
-				       with_des=yes], with_des=no)
+  AC_CHECK_LIB(des, des_pcbc_encrypt,
+	AC_CHECK_HEADER(des.h, [LIB_DES="-ldes";
+				with_des=yes],
+			with_des=no),
+	with_des=no)
 
   if test "$with_des" = no; then
     dnl if openssl is around, we might be able to use that for des
@@ -694,6 +700,9 @@
 
 LTLIBOBJS=`echo "$LIBOBJS" | sed 's/\.o/.lo/g'`
 AC_SUBST(LTLIBOBJS)
+
+dnl Check for /dev/urandom
+AC_CHECK_FILE(/dev/urandom, AC_DEFINE_UNQUOTED(SASL_DEV_RANDOM, "/dev/urandom"))
 
 AC_CHECK_HEADERS(getopt.h unistd.h crypt.h pwd.h shadow.h paths.h)
 AC_C_CONST
