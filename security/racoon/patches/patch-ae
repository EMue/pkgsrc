$NetBSD: patch-ae,v 1.3 2000/09/24 17:28:25 itojun Exp $

Index: session.c
===================================================================
RCS file: /cvsroot/kame/kame/kame/kame/racoon/session.c,v
retrieving revision 1.13
diff -u -r1.13 session.c
--- session.c	2000/09/22 18:35:53	1.13
+++ session.c	2000/09/24 17:25:49
@@ -112,8 +112,10 @@
 
 	FD_ZERO(&mask0);
 
+#ifdef ENABLE_ADMINPORT
 	FD_SET(lcconf->sock_admin, &mask0);
 	nfds = (nfds > lcconf->sock_admin ? nfds : lcconf->sock_admin);
+#endif
 	FD_SET(lcconf->sock_pfkey, &mask0);
 	nfds = (nfds > lcconf->sock_pfkey ? nfds : lcconf->sock_pfkey);
 	FD_SET(lcconf->rtsock, &mask0);
@@ -157,8 +159,10 @@
 			/*NOTREACHED*/
 		}
 
+#ifdef ENABLE_ADMINPORT
 		if (FD_ISSET(lcconf->sock_admin, &rfds))
 			admin_handler();
+#endif
 
 		for (p = lcconf->myaddrs; p; p = p->next) {
 			if (!p->addr)
@@ -185,9 +189,11 @@
 			FD_ZERO(&mask0);
 			nfds = 0;
 
+#ifdef ENABLE_ADMINPORT
 			FD_SET(lcconf->sock_admin, &mask0);
 			nfds = (nfds > lcconf->sock_admin
 				? nfds : lcconf->sock_admin);
+#endif
 			FD_SET(lcconf->sock_pfkey, &mask0);
 			nfds = (nfds > lcconf->sock_pfkey
 				? nfds : lcconf->sock_pfkey);
@@ -364,7 +370,9 @@
 {
 	isakmp_close();
 	pfkey_close(lcconf->sock_pfkey);
+#ifdef ENABLE_ADMINPORT
 	(void)admin_close();
+#endif
 	return 0;
 }
 
