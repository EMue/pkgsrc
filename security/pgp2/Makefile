# $NetBSD: Makefile,v 1.6 1998/04/22 14:22:48 agc Exp $
# FreeBSD Id: Makefile,v 1.20 1997/08/27 13:06:01 ache Exp
#

DISTNAME=	pgp263is
WRKSRC=		${WRKDIR}/src
CATEGORIES=	security
# International PGP homepage is http://www.ifi.uio.no/pgp/
MASTER_SITES=	ftp://ftp.ifi.uio.no/pub/pgp/2.x/src/ \
		ftp://ftp.kiarchive.ru/pub/unix/crypto/pgp/

MAINTAINER=	packages@NetBSD.ORG

.if defined(MAKECONF) && exists(${MAKECONF})
.include "${MAKECONF}"
.elif exists(/etc/mk.conf)
.include "/etc/mk.conf"
.endif

.if defined(USE_RSAREF2) && ${USE_RSAREF2} == YES
PKGNAME=	pgp-2.6.3a
DEPENDS+=	rsaref-2.0:../../security/rsaref
RSAINC=		-I${PREFIX}/include
RSALIBS=	-L${PREFIX}/lib -lrsaref
RSAOBJS=	rsaglue2.o
CFLAGS=		-DUSA
.else
PKGNAME=	pgp-2.6.3ia
RSAINC=
RSALIBS=
RSAOBJS=	rsaglue1.o
CFLAGS=
.endif

RESTRICTED=	"Cryptographic software"
PGPLIB=		${PREFIX}/lib/pgp
CFLAGS+=	-DPGP_SYSTEM_DIR=\\\"${PGPLIB}/\\\"
IS_INTERACTIVE=	yes

MAN1=		pgp.1

.if ${MACHINE_ARCH} == "i386"
OBJS_EXT=	_80386.o _zmatch.o
ASMFLAG=	-DASM
.elif ${MACHINE_ARCH} == "m68k"
OBJS_EXT=	mc68020.o
ASMFLAG=
.elif ${MACHINE_ARCH} == "sparc"
OBJS_EXT=	sparc.o
ASMFLAG=
.else
OBJS_EXT=
ASMFLAG=	-DPORTABLE -DMPORTABLE
.endif

.if !defined(USE_RSAREF2) || ${USE_RSAREF2} != YES && ${USE_RSAREF2} != NO
pre-fetch:
	@${ECHO}
	@${ECHO} The variable USE_RSAREF2 must be set to either YES or NO
	@${ECHO} in order to build this package.  USA residents not at the
	@${ECHO} Massachusetts Institute of Technology MUST set this
	@${ECHO} variable to YES.  Users outside the USA MUST set this
	@${ECHO} variable to NO.  People at MIT may choose -- NO is faster.
	@${FALSE}
.endif

post-extract:
	cd ${WRKDIR} && ${EXTRACT_CMD} -xf pgp263ii.tar && ${RM} -f pgp263ii.tar

do-build:
	cd ${WRKSRC} && ${MAKE} all CC=${CC} LD=${CC} OBJS_EXT="${OBJS_EXT}" \
		CFLAGS="${CFLAGS} ${RSAINC} ${ASMFLAG} -O2 -DUNIX -DIDEA32 \
		-DMAX_NAMELEN=255" RSALIBS="${RSALIBS}" RSAOBJS="${RSAOBJS}"

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/pgp ${PREFIX}/bin
	${INSTALL_DATA} ${WRKDIR}/doc/pgp.1 ${PREFIX}/man/man1
	-${MKDIR} ${PGPLIB}
	cd ${WRKDIR}/doc && ${INSTALL_DATA} pgpdoc1.txt pgpdoc2.txt ${PGPLIB}
	cd ${WRKDIR} && \
		${INSTALL_DATA} de.hlp en.hlp es.hlp fr.hlp pgp.hlp ${PGPLIB}
	[ -f ${PGPLIB}/language.txt ] || \
		${INSTALL_DATA} ${WRKDIR}/language.txt ${PGPLIB}
	[ -f ${PGPLIB}/config.txt ] || \
		${INSTALL_DATA} ${WRKDIR}/config.txt ${PGPLIB}
	[ -f ${PGPLIB}/pgp.hlp ] || \
		${INSTALL_DATA} ${WRKDIR}/en.hlp ${PGPLIB}/pgp.hlp

.include "../../mk/bsd.pkg.mk"
