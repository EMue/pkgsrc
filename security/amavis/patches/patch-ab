$NetBSD: patch-ab,v 1.2 2000/10/23 14:57:16 rh Exp $

--- src/scanmails/scanmails.in.orig	Sat Sep 16 17:40:38 2000
+++ src/scanmails/scanmails.in
@@ -352,7 +352,7 @@
 	sendmail_flags="${sendmail_flags} -C${origconf}"
    else
 	SENDER="$2"
-	RECEIPIENT="$7"
+	RECEIPIENT="$4"
    fi
 fi
 
@@ -447,6 +447,8 @@
     cat | ${formail} -f -A "${X_Header_String}" >${tmpdir}/receivedmail
 else
     cat >${tmpdir}/receivedmail
+    awk <${tmpdir}/receivedmail >${tmpdir}/header '/^$/ {exit 0;} // {print;}'
+    maildest=`grep '^To:' ${tmpdir}/header | head -1 | cut -d' ' -f 2-`
 fi
 
 mkdir ${tmpdir}/unpacked
@@ -1210,7 +1212,7 @@
 
                    V I R U S  A L E R T
 
-  Our viruschecker found a VIRUS in your email to "${receiver}".
+  Our viruschecker found a VIRUS in your email to "${maildest}".
            We stopped delivery of this email!
 
     Now it is on you to check your system for viruses           
@@ -1236,7 +1238,7 @@
 
 ############### send a mail to the addressee ########################
 
-cat <<EOF| ${sendmail_wrapper} ${sendmail_flags}
+cat <<EOF| cat - ${tmpdir}/header | ${sendmail_wrapper} ${sendmail_flags}
 From: ${mailfrom}
 To: ${receiver}
 Subject: VIRUS IN A MAIL FOR YOU FROM ${sender}
@@ -1250,6 +1252,8 @@
   Delivery of the email was stopped!
   
   Please contact your system administrator for details
+
+  The header of the stopped message was:
 
 EOF
 fi
