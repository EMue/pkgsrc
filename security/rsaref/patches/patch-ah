$NetBSD: patch-ah,v 1.2 1999/12/02 17:20:14 sommerfeld Exp $

--- ../source/rsa.c.orig	Fri Mar 25 14:01:48 1994
+++ ../source/rsa.c	Thu Dec  2 11:39:43 1999
@@ -11,10 +11,10 @@
 #include "rsa.h"
 #include "nn.h"
 
-static int RSAPublicBlock PROTO_LIST 
+int RSAPublicBlock PROTO_LIST 
   ((unsigned char *, unsigned int *, unsigned char *, unsigned int,
     R_RSA_PUBLIC_KEY *));
-static int RSAPrivateBlock PROTO_LIST 
+int RSAPrivateBlock PROTO_LIST 
   ((unsigned char *, unsigned int *, unsigned char *, unsigned int,
     R_RSA_PRIVATE_KEY *));
 
@@ -33,6 +33,8 @@
   unsigned char byte, pkcsBlock[MAX_RSA_MODULUS_LEN];
   unsigned int i, modulusLen;
   
+  if (inputLen+3>MAX_RSA_MODULUS_LEN) return (RE_LEN);
+
   modulusLen = (publicKey->bits + 7) / 8;
   if (inputLen + 11 > modulusLen)
     return (RE_LEN);
@@ -78,6 +80,8 @@
   unsigned char pkcsBlock[MAX_RSA_MODULUS_LEN];
   unsigned int i, modulusLen, pkcsBlockLen;
   
+  if (inputLen>MAX_RSA_MODULUS_LEN) return (RE_LEN);
+
   modulusLen = (publicKey->bits + 7) / 8;
   if (inputLen > modulusLen)
     return (RE_LEN);
@@ -129,6 +133,8 @@
   unsigned char pkcsBlock[MAX_RSA_MODULUS_LEN];
   unsigned int i, modulusLen;
   
+  if (inputLen+3>MAX_RSA_MODULUS_LEN) return (RE_LEN);
+
   modulusLen = (privateKey->bits + 7) / 8;
   if (inputLen + 11 > modulusLen)
     return (RE_LEN);
@@ -168,6 +174,8 @@
   unsigned char pkcsBlock[MAX_RSA_MODULUS_LEN];
   unsigned int i, modulusLen, pkcsBlockLen;
   
+  if (inputLen>MAX_RSA_MODULUS_LEN) return (RE_LEN);
+
   modulusLen = (privateKey->bits + 7) / 8;
   if (inputLen > modulusLen)
     return (RE_LEN);
@@ -212,7 +220,7 @@
    Assumes inputLen < length of modulus.
    Requires input < modulus.
  */
-static int RSAPublicBlock (output, outputLen, input, inputLen, publicKey)
+int RSAPublicBlock (output, outputLen, input, inputLen, publicKey)
 unsigned char *output;                                      /* output block */
 unsigned int *outputLen;                          /* length of output block */
 unsigned char *input;                                        /* input block */
@@ -252,7 +260,7 @@
    Assumes inputLen < length of modulus.
    Requires input < modulus.
  */
-static int RSAPrivateBlock (output, outputLen, input, inputLen, privateKey)
+int RSAPrivateBlock (output, outputLen, input, inputLen, privateKey)
 unsigned char *output;                                      /* output block */
 unsigned int *outputLen;                          /* length of output block */
 unsigned char *input;                                        /* input block */
