$NetBSD: patch-bf,v 1.2 2000/03/20 02:25:55 itojun Exp $

--- servconf.c-	Wed May 12 20:19:28 1999
+++ servconf.c	Mon Mar 20 09:47:32 2000
@@ -106,6 +106,12 @@
   options->kerberos_authentication = -1;
   options->kerberos_or_local_passwd = -1;
   options->kerberos_tgt_passing = -1;
+#if defined(KRB4)
+  options->kerberos_ticket_cleanup = -1;
+#endif /* KRB4 */
+#ifdef AFS
+  options->afs_token_passing = -1;
+#endif
   options->tis_authentication = -1;
   options->allow_tcp_forwarding = -1;
   options->password_authentication = -1;
@@ -190,19 +196,27 @@
   if (options->rsa_authentication == -1)
     options->rsa_authentication = 1;
   if (options->kerberos_authentication == -1)
-#if defined(KERBEROS) && defined(KRB5)
+#if defined(KRB4) || defined(KRB5)
     options->kerberos_authentication = 1;
-#else  /* defined(KERBEROS) && defined(KRB5) */
+#else
     options->kerberos_authentication = 0;
-#endif /* defined(KERBEROS) && defined(KRB5) */
+#endif /* defined(KRB4 || KRB5 */
   if (options->kerberos_or_local_passwd == -1)
     options->kerberos_or_local_passwd = 0;
   if (options->kerberos_tgt_passing == -1)
-#if defined(KERBEROS_TGT_PASSING) && defined(KRB5)
+#if defined(AFS) || defined(KRB5)
     options->kerberos_tgt_passing = 1;
-#else  /* defined(KERBEROS_TGT_PASSING) && defined(KRB5) */
+#else
     options->kerberos_tgt_passing = 0;
-#endif /* defined(KERBEROS_TGT_PASSING) && defined(KRB5) */
+#endif /* AFS || KRB5 */
+#if defined(KRB4)
+  if (options->kerberos_ticket_cleanup == -1)
+    options->kerberos_ticket_cleanup = 1;
+#endif /* KRB4 */
+#ifdef AFS
+  if (options->afs_token_passing == -1)
+    options->afs_token_passing = 1;
+#endif /* AFS */
   if (options->allow_tcp_forwarding == -1)
     options->allow_tcp_forwarding = 1;
   if (options->tis_authentication == -1)
@@ -249,7 +263,14 @@
   sStrictModes, sEmptyPasswd, sRandomSeedFile, sKeepAlives, sPidFile,
   sForcedPasswd, sForcedEmptyPasswd, sUmask, sSilentDeny, sIdleTimeout,
   sUseLogin, sKerberosAuthentication, sKerberosOrLocalPasswd,
-  sKerberosTgtPassing, sAllowTcpForwarding, sAllowUsers, sDenyUsers,
+  sKerberosTgtPassing,
+#ifdef KRB4
+  sKerberosTicketCleanup,
+#ifdef AFS
+  sAFSTokenPassing,
+#endif /* AFS */
+#endif /* KRB4 */
+  sAllowTcpForwarding, sAllowUsers, sDenyUsers,
   sXauthPath, sCheckMail, sDenyGroups, sAllowGroups, sIgnoreRootRhosts,
   sAllowSHosts, sDenySHosts, sPasswordExpireWarningDays,
   sAccountExpireWarningDays
@@ -313,6 +334,12 @@
   { "kerberosauthentication", sKerberosAuthentication },
   { "kerberosorlocalpasswd", sKerberosOrLocalPasswd },
   { "kerberostgtpassing", sKerberosTgtPassing },
+#ifdef KRB4
+  { "kerberosticketcleanup", sKerberosTicketCleanup },
+#endif
+#ifdef AFS
+  { "afstokenpassing", sAFSTokenPassing },
+#endif
   { "allowtcpforwarding", sAllowTcpForwarding },
   { "xauthlocation", sXauthPath },
   { "checkmail", sCheckMail },
@@ -571,6 +598,18 @@
  	case sKerberosTgtPassing:
  	  intptr = &options->kerberos_tgt_passing;
  	  goto parse_flag;
+
+#ifdef KRB4
+	case sKerberosTicketCleanup:
+	  intptr = &options->kerberos_ticket_cleanup;
+	  goto parse_flag;
+#endif /* KRB4 */
+
+#ifdef AFS
+	case sAFSTokenPassing:
+	  intptr = &options->afs_token_passing;
+	  goto parse_flag;
+#endif /* AFS */
 	  
  	case sAllowTcpForwarding:
  	  intptr = &options->allow_tcp_forwarding;
