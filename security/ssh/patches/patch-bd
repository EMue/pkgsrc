$NetBSD: patch-bd,v 1.2 2000/03/20 02:25:55 itojun Exp $

--- readconf.c-	Wed May 12 20:19:27 1999
+++ readconf.c	Mon Mar 20 09:47:24 2000
@@ -170,6 +170,9 @@
   oGlobalKnownHostsFile, oUserKnownHostsFile, oConnectionAttempts,
   oBatchMode, oStrictHostKeyChecking, oCompression, oCompressionLevel,
   oKeepAlives, oUsePrivilegedPort, oKerberosAuthentication,
+#ifdef AFS
+  oAFSTokenPassing,
+#endif /* AFS */
   oKerberosTgtPassing, oClearAllForwardings, oNumberOfPasswordPrompts,
   oXauthPath, oGatewayPorts, oPasswordPromptLogin, oPasswordPromptHost
 } OpCodes;
@@ -213,6 +216,9 @@
   { "useprivilegedport", oUsePrivilegedPort },
   { "kerberosauthentication", oKerberosAuthentication },
   { "kerberostgtpassing", oKerberosTgtPassing },
+#ifdef AFS
+  { "afstokenpassing", oAFSTokenPassing },
+#endif /* AFS */
   { "clearallforwardings", oClearAllForwardings },
   { "numberofpasswordprompts", oNumberOfPasswordPrompts },
   { "xauthlocation", oXauthPath },
@@ -354,6 +360,12 @@
       intptr = &options->kerberos_tgt_passing;
       goto parse_flag;
       
+#ifdef AFS
+    case oAFSTokenPassing:
+      intptr = &options->afs_token_passing;
+      goto parse_flag;
+#endif /* AFS */
+      
     case oFallBackToRsh:
       intptr = &options->fallback_to_rsh;
       goto parse_flag;
@@ -678,6 +690,9 @@
   options->rsa_authentication = -1;
   options->kerberos_authentication = -1;
   options->kerberos_tgt_passing = -1;
+#ifdef AFS
+  options->afs_token_passing = -1;
+#endif /* AFS */
   options->tis_authentication = -1;
   options->password_authentication = -1;
   options->rhosts_rsa_authentication = -1;
@@ -724,17 +739,19 @@
   if (options->rsa_authentication == -1)
     options->rsa_authentication = 1;
   if (options->kerberos_authentication == -1)
-#if defined(KERBEROS) && defined(KRB5)
+#if defined(KRB4) || defined(KRB5)
     options->kerberos_authentication = 1;
-#else  /* defined(KERBEROS) && defined(KRB5) */
+#else
     options->kerberos_authentication = 0;
-#endif /* defined(KERBEROS) && defined(KRB5) */
+#endif /* defined(KRB4) ||  defined(KRB5) */
   if (options->kerberos_tgt_passing == -1)
-#if defined(KERBEROS_TGT_PASSING) && defined(KRB5)
+#if defined(AFS)
     options->kerberos_tgt_passing = 1;
-#else  /* defined(KERBEROS_TGT_PASSING) && defined(KRB5) */
+  if (options->afs_token_passing == -1)
+    options->afs_token_passing = 1;
+#else
     options->kerberos_tgt_passing = 0;
-#endif /* defined(KERBEROS_TGT_PASSING) && defined(KRB5) */
+#endif /* AFS */
   if (options->tis_authentication == -1)
     options->tis_authentication = 0;
   if (options->password_authentication == -1)
