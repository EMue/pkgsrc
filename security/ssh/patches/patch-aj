# $NetBSD: patch-aj,v 1.8 1999/11/30 09:08:46 explorer Exp $
--- configure.orig	Wed May 12 04:20:06 1999
+++ configure	Mon Nov 29 16:04:16 1999
@@ -1989,12 +1989,6 @@
 
 export CFLAGS CC
 
-# Socket pairs appear to be broken on several systems.  I don't know exactly
-# where, so I'll use pipes everywhere for now.
-cat >> confdefs.h <<\EOF
-#define USE_PIPES 1
-EOF
-
 
 echo $ac_n "checking that the compiler works""... $ac_c" 1>&6
 echo "configure:2001: checking that the compiler works" >&5
@@ -4997,7 +4991,7 @@
 
   # It would also be nice to do this for all -L options, not just this one.
   if test -n "$x_libraries"; then
-    X_LIBS="$X_LIBS -L$x_libraries"
+    X_LIBS="$X_LIBS -L$x_libraries -Wl,-R$x_libraries"
     # For Solaris; some versions of Sun CC require a space after -R and
     # others require no space.  Words are not sufficient . . . .
     case "`(uname -sr) 2>/dev/null`" in
@@ -6604,8 +6598,8 @@
 #define HAVE_TIS 1
 EOF
 
-    CFLAGS="$CFLAGS -I$withval -DHAVE_TIS"
-    LIBS="-L$withval -lauth -lfwall $LIBS"
+    CFLAGS="$CFLAGS -I$withval/include -DHAVE_TIS"
+    LIBS="-L$withval/lib -lauth -lfwall $LIBS"
     echo "configure: warning: Remember to read README.TIS. The connection between sshd and TIS authentication
 server is clear text!" 1>&2
     ;;
@@ -6646,8 +6640,8 @@
 EOF
 
   KERBEROS_ROOT="$with_kerberos5"
-  KERBEROS_INCS="-I${KERBEROS_ROOT}/include"
-  KERBEROS_LIBS="-L${KERBEROS_ROOT}/lib -lgssapi_krb5 -lkrb5 -lcrypto -lcom_err"
+  KERBEROS_INCS="-I${KERBEROS_ROOT}/include/krb5"
+  KERBEROS_LIBS="-L${KERBEROS_ROOT}/lib -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err"
   echo $ac_n "checking for dbm_open in -lndbm""... $ac_c" 1>&6
 echo "configure:6653: checking for dbm_open in -lndbm" >&5
 ac_lib_var=`echo ndbm'_'dbm_open | sed 'y%./+-%__p_%'`
@@ -7295,15 +7289,15 @@
    case "$enableval" in
   no)
        echo "$ac_t""no" 1>&6
-       SSHINSTALLMODE=0711
+       SSHINSTALLMODE=0511
        ;;
   *)   echo "$ac_t""yes" 1>&6
-       SSHINSTALLMODE=04711
+       SSHINSTALLMODE=04511
        ;;
   esac 
 else
   echo "$ac_t""yes" 1>&6
-  SSHINSTALLMODE=04711
+  SSHINSTALLMODE=04511
 
 fi
 
@@ -7583,7 +7577,7 @@
 ac_given_srcdir=$srcdir
 ac_given_INSTALL="$INSTALL"
 
-trap 'rm -fr `echo "Makefile sshd.8 ssh.1 make-ssh-known-hosts.1 zlib-1.0.4/Makefile config.h" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
+trap 'rm -fr `echo "Makefile sshd.8 ssh.1 make-ssh-known-hosts.pl make-ssh-known-hosts.1 zlib-1.0.4/Makefile config.h" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
 EOF
 cat >> $CONFIG_STATUS <<EOF
 
@@ -7691,7 +7685,7 @@
 
 cat >> $CONFIG_STATUS <<EOF
 
-CONFIG_FILES=\${CONFIG_FILES-"Makefile sshd.8 ssh.1 make-ssh-known-hosts.1 zlib-1.0.4/Makefile"}
+CONFIG_FILES=\${CONFIG_FILES-"Makefile sshd.8 ssh.1 make-ssh-known-hosts.pl make-ssh-known-hosts.1 zlib-1.0.4/Makefile"}
 EOF
 cat >> $CONFIG_STATUS <<\EOF
 for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
