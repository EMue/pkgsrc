$NetBSD: patch-ai,v 1.6 2000/03/20 02:25:50 itojun Exp $

--- scp.c-	Wed May 12 20:19:28 1999
+++ scp.c	Mon Mar 20 09:53:06 2000
@@ -180,6 +180,11 @@
 #define STDERR_FILENO 2
 #endif
 
+#ifdef AFS
+/* This is set to non-zero to disable authentication forwarding. */
+int nofwd = 0;
+#endif /* AFS */
+
 /* This is set to non-zero to enable verbose mode. */
 int verbose = 0;
 
@@ -305,6 +310,10 @@
         args[i++] = "-P";
       if (batchmode)
         args[i++] = "-oBatchMode yes";
+#ifdef AFS
+      if (nofwd)
+	args[i++] = "-k";
+#endif /* AFS */
       if (cipher != NULL)
         {
           args[i++] = "-c";
@@ -441,7 +450,11 @@
             statistics = 0;
 
         fflag = tflag = 0;
-        while ((ch = getopt(argc, argv, "aAqQdfprtvBCL1c:i:P:o:S:")) != EOF)
+        while ((ch = getopt(argc, argv, "aAqQdfprtvBCL1c:i:P:o:S"
+#ifdef AFS
+		"k"
+#endif
+		)) != EOF)
                 switch(ch) {                    /* User-visible flags. */
                 case 'S':
                         ssh_program = optarg;
@@ -490,6 +503,11 @@
                 case 'r':
                         iamrecursive = 1;
                         break;
+#ifdef AFS
+ 	        case 'k':
+			nofwd = 1;
+			break;
+#endif /* AFS */
                                                 /* Server options. */
                 case 'd':
                         targetshouldbedirectory = 1;
