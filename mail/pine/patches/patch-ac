$NetBSD: patch-ac,v 1.7 1998/11/13 16:32:38 tv Exp $

--- pine/makefile.neb.orig	Thu Aug 27 12:50:02 1998
+++ pine/makefile.neb	Sun Sep 27 16:45:10 1998
@@ -45,9 +45,12 @@
 RM=          rm -f
 LN=          ln -s
 MAKE=        make
-OPTIMIZE=    # -O
+.if (${MACHINE_ARCH} != "arm32")
+# XXX broken arm32 compiler can't optimize several of these source files
+OPTIMIZE=    -O
+.endif
 PROFILE=     # -pg
-DEBUG=       -g -DDEBUG
+DEBUG=       # -g -DDEBUG
 
 CCLIENTDIR=  ../c-client
 PICODIR=     ../pico
@@ -61,8 +64,8 @@
 	      other.o pine.o takeaddr.o
 
 STDLIBS=     -ltermlib
-LOCLIBS=     $(PICODIR)/libpico.a $(CCLIENTDIR)/c-client.a
-LIBS=        $(EXTRALIBES) $(LOCLIBS) $(LDAPLIBS) $(STDLIBS) \
+LOCLIBS=     -lpico $(CCLIENTDIR)/c-client.a
+LIBS=        -L$(PREFIX)/lib -Wl,-R$(PREFIX)/lib/ $(EXTRALIBES) $(LOCLIBS) $(LDAPLIBS) $(STDLIBS) \
              `cat $(CCLIENTDIR)/LDFLAGS`
 
 STDCFLAGS=   -DNETBSD -DSYSTYPE=\"NEB\" -DMOUSE
@@ -82,13 +85,15 @@
 	$(CCLIENTDIR)/mail.h $(CCLIENTDIR)/osdep.h \
 	$(CCLIENTDIR)/rfc822.h $(CCLIENTDIR)/misc.h
 
+all: pine abookcpy
+
 pine:  $(OFILES) $(LOCLIBS)
 	echo "char datestamp[]="\"`date`\"";" > date.c
 	echo "char hoststamp[]="\"`hostname`\"";" >> date.c
 	$(CC) $(LDFLAGS) $(CFLAGS) -o pine $(OFILES) date.c $(LIBS)
 
 abookcpy:	abookcpy.o $(LOCLIBES)
-	$(CC) $(LDFLAGS) $(CFLAGS) -o abookcpy abookcpy.o $(LIBS)
+	$(CC) $(LDFLAGS) $(CFLAGS) -o abookcpy abookcpy.o $(CCLIENTDIR)/c-client.a -lcrypt
 
 pine-use:	pine-use.c
 	$(CC) -o pine-use pine-use.c
