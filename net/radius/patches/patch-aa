$NetBSD: patch-aa,v 1.4 1999/12/05 22:46:45 tron Exp $

--- Makefile.orig	Sun Dec  5 23:41:31 1999
+++ Makefile	Sun Dec  5 23:43:38 1999
@@ -51,11 +51,12 @@
 # Where the configuration files live.
 RADDB		= ./raddb
 # Some installation stuff.
-DAEMON_INSDIR	= /usr/private/etc
-BIN_INSDIR	= /usr/private/etc
-MAN_INSDIR	= /usr/local/man
-RADDB_INSDIR	= /usr/private/etc/raddb.new
-RADACCT_INSDIR	= /usr/private/etc/radacct
+DAEMON_INSDIR	= ${PREFIX}/sbin
+BIN_INSDIR	= ${PREFIX}/sbin
+MAN_INSDIR	= ${PREFIX}/man
+RADDB_INSDIR	= /etc/raddb
+RADDB_EXDIR	= ${PREFIX}/share/examples/radius
+RADACCT_INSDIR	= /var/log
 # The server does not need to be owned by root, unless some shadow password
 # scheme needs it.  You might create a user id "radius" for just this purpose.
 # The O G and M macros are for AIX, OSF/1 and HP-UX, see below.
@@ -63,12 +64,12 @@
 G		= -g
 M		= -m
 RADOWN		= root
-RADGRP		= bin
+RADGRP		= wheel
 
 # Define COMPRESS to hold the pathname of your favourite compress program if
 # you need to override the default value of /usr/ucb/compress:
-#COMPRESS	= -DRAD_COMPRESS=\"/usr/local/bin/gzip\"
-#COMPRESS_ARGS	= -DCOMPRESS_ARGS=\"-9\"
+COMPRESS	= -DRAD_COMPRESS=\"${GNUZIP}\"
+COMPRESS_ARGS	= -DCOMPRESS_ARGS=\"-nf9\"
 
 # Define SRV to hold any combination of server names you'd like to override:
 #SRV3	  = -DDEFAULT_TACACS_SERVER=\"vms.dns.name\"
@@ -78,8 +79,8 @@
 
 # Define DIRS to hold any combination of directory names you'd like to override:
 #DIRS2	  = -DDEFAULT_DIR=\"../raddb\" -DDEFAULT_DIR2=\"$(RADDB_INSDIR)\"
-#DIRS1	  = -DRADIUS_DIR=\"$(RADDB_INSDIR)\" -DRADACCT_DIR=\"$(RADACCT_INSDIR)\"
-#DIRS	  = $(DIRS1) $(DIRS2)
+DIRS1	  = -DRADIUS_DIR=\"$(RADDB_INSDIR)\" -DRADACCT_DIR=\"$(RADACCT_INSDIR)\"
+DIRS	  = $(DIRS1) $(DIRS2)
 
 # Define CHK_SHELLS to enable /etc/shells checking:
 CHK_SHELLS	= -DCHK_SHELLS
@@ -90,13 +91,13 @@
 # -DBINARY_FILTERS - support for Ascend binary filters
 # -DIP_ADDR_POOL - support for Ascend IP address pools
 #
-ASCEND	  = -DASCEND -DBINARY_FILTERS
+ASCEND	  = -DASCEND -DBINARY_FILTERS -DIP_ADDR_POOL
 
 # Define USR_CCA to enable USR support:
 #USR	  = -DUSR_CCA
 
 # Define RAD_LOG_FMT to change how the logfile name changes:
-RAD_LOG_FMT	= -DRADIUS_LOG_FMT=\"logfile.%y%m%d\"
+RAD_LOG_FMT	= -DRADIUS_LOG_FMT=\"radius\"
 
 STUFF	  = $(DIRS) $(SRV) $(COMPRESS) $(COMPRESS_ARGS) $(CHK_SHELLS) \
 	$(ASCEND) $(USR)
@@ -122,10 +123,10 @@
 # radiusd -- the default
 #
 #--------------------------------------------------------------------------
-DEFS	  = -DHAVE_SETVBUF -DNOSHADOW $(MERIT) $(STUFF) \
-            -DMODVERSION
-RADLIBS	  = ./logdaemon-5.6/skey/libskey.a
-INCS	  = -I./logdaemon-5.6/skey
+#DEFS	  = -DHAVE_SETVBUF -DNOSHADOW $(MERIT) $(STUFF) \
+#            -DMODVERSION
+#RADLIBS	  = ./logdaemon-5.6/skey/libskey.a
+#INCS	  = -I./logdaemon-5.6/skey
 
 #
 # mkerb
@@ -186,9 +187,9 @@
 	$(OBJ)/fsm.o $(OBJ)/fwd2nas.o $(OBJ)/nas_reb.o $(OBJ)/res_qry.o       \
 	$(OBJ)/rf_req.o $(OBJ)/rf_resp.o $(OBJ)/arades.o $(OBJ)/cache.o       \
 	$(OBJ)/pooladdr.o $(OBJ)/rad.bsd.o                                    \
+	$(OBJ)/rad.simult.o \
 	$(OBJ)/rad.skey.o \
-	$(OBJ)/rad.ftp.o \
-	$(OBJ)/modversion.o
+	$(OBJ)/rad.ftp.o
 
 LIB_OBJS  = $(OBJ)/des.o $(OBJ)/dict.o $(OBJ)/filters.o $(OBJ)/funcs.o        \
 	$(OBJ)/md5.o $(OBJ)/sendserver.o $(OBJ)/users.o $(OBJ)/resources.o    \
@@ -236,12 +237,12 @@
 #
 #--------------------------------------------------------------------------
 
-CC	  = cc
-CFLAGS	  = -g $(DEFS) $(INCS)
-LDFLAGS	  =
-LIBS	  =
-RANLIB	  = ranlib
-INSTALL	  = /bin/install
+#CC	  = cc
+#CFLAGS	  = -g $(DEFS) $(INCS)
+#LDFLAGS	  =
+#LIBS	  =
+#RANLIB	  = ranlib
+#INSTALL	  = /bin/install
 
 #
 # Solaris 2.x [[NB: if BIND/named not SMCC, try CFLAGS = ... -DBSD=1 ...]]
@@ -438,6 +439,8 @@
 
 # You must un-comment one, and only one, of the above sections!
 
+CFLAGS+= ${MERIT} ${STUFF}
+
 # No modifications are necessary below this line except possibly near line 500.
 
 all:	notice $(RADIUS) utils
@@ -696,26 +699,26 @@
 						$(MAN_INSDIR)/man8/radpwtst.8
 
 config-install: $(CONFIGS)
-	-if [ ! -d $(RADDB_INSDIR) ] ;\
+	-if [ ! -d $(RADDB_EXDIR) ] ;\
 	then \
-		/bin/mkdir -p $(RADDB_INSDIR) ;\
+		/bin/mkdir -p $(RADDB_EXDIR) ;\
 	fi
 	$(INSTALL) $(M) 660 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/authfile \
-						$(RADDB_INSDIR)/authfile
+						$(RADDB_EXDIR)/authfile
 	$(INSTALL) $(M) 660 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/clients \
-						$(RADDB_INSDIR)/clients
+						$(RADDB_EXDIR)/clients
 	$(INSTALL) $(M) 755 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/conversion.pl \
-						$(RADDB_INSDIR)/conversion.pl
+						$(RADDB_EXDIR)/conversion.pl
 	$(INSTALL) $(M) 644 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/dictionary \
-						$(RADDB_INSDIR)/dictionary
+						$(RADDB_EXDIR)/dictionary
 	$(INSTALL) $(M) 644 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/engine.config \
-						$(RADDB_INSDIR)/engine.config
+						$(RADDB_EXDIR)/engine.config
 	$(INSTALL) $(M) 660 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/users \
-						$(RADDB_INSDIR)/users
+						$(RADDB_EXDIR)/users
 	$(INSTALL) $(M) 644 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/vendors \
-						$(RADDB_INSDIR)/vendors
+						$(RADDB_EXDIR)/vendors
 	$(INSTALL) $(M) 644 $(O) $(RADOWN) $(G) $(RADGRP) $(RADDB)/xas.fsm \
-						$(RADDB_INSDIR)/xas.fsm
+						$(RADDB_EXDIR)/xas.fsm
 	-if [ ! -d $(RADACCT_INSDIR) ] ;\
 	then \
 		/bin/mkdir -p $(RADACCT_INSDIR) ;\
