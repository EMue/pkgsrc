$NetBSD: patch-ad,v 1.2 2000/08/06 15:35:10 tron Exp $

--- src/rad.skey.c.orig	Sat Oct 10 22:18:08 1998
+++ src/rad.skey.c	Sun Aug  6 17:32:58 2000
@@ -2,6 +2,7 @@
 /*   Bradley Urberg Carlson <bradley@mr.net>   */
 
 #include <stdio.h>
+#include <sys/types.h>
 #include <netinet/in.h>
 #include <syslog.h>
 #include <sys/param.h>
@@ -75,11 +76,15 @@
 		*ptr = NULL;
 	}
 
+#ifndef __NetBSD__
 	/* Check if this user has valid SKEY information and get the challenge. */
 	if (skeyinfo(&skey, username, challenge) == 0)
 	{
 		/* position the pointer in the key for verification */
 		if (skeylookup (&skey, username) != 0) 
+#else
+		if (skeychallenge (&skey, username, challenge, sizeof(challenge)) != 0) 
+#endif
 		{
 			dprintf(2, (LOG_DAEMON, LOG_DEBUG, "%s: skeylookup failed.", func));
 			return EV_NAK;
@@ -92,7 +97,9 @@
 		}
 		reply_sprintf (0, authreq, "%s", challenge);
 		return EV_NAK;
+#ifndef __NetBSD__
 	}
 	/* The user has no SKEY information.  Just NAK */
 	return EV_NAK;
+#endif
 }
