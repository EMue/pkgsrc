$NetBSD: patch-am,v 1.3 1999/02/14 15:27:51 rh Exp $

--- src/extensions.c.orig	Mon Jul  6 11:14:17 1998
+++ src/extensions.c	Sun Feb 14 14:53:10 1999
@@ -990,14 +990,19 @@
        *ap3 = NULL,
        *ap4 = NULL,
        *ap6 = NULL;
-  char cwdir[BUFSIZ];
-  char path[BUFSIZ];
+  char cwdir[MAXPATHLEN];
+  char path[MAXPATHLEN];
   char *sp;
   extern struct passwd *pw;
 
   *valid = 0;
   /* what's our current directory? */
 
+  if (strlen (name) >= sizeof path) { /* path too long? --> bail out */
+    perror_reply(550, "Could not determine cwdir");
+    return(-1);
+  }
+
   strcpy(path, name);
   if (sp = strrchr(path, '/'))  *sp = '\0';
   else strcpy(path, ".");
@@ -1046,8 +1051,8 @@
 #endif
 {
   int  match_value = -1;
-  char cwdir[BUFSIZ];
-  char path[BUFSIZ];
+  char cwdir[MAXPATHLEN];
+  char path[MAXPATHLEN];
   char *sp;
   int  i;
 
@@ -1063,6 +1068,11 @@
   *valid = 0;
 
       /* what's our current directory? */
+
+      if (strlen (name) >= sizeof path) { /* path too long? --> bail out */
+          perror_reply(550, "Could not determine cwdir");
+          return(-1);
+      }
 
       strcpy(path, name);
       if (sp = strrchr(path, '/'))  *sp = '\0';
