$NetBSD: patch-ac,v 1.6 2001/05/10 09:00:24 abs Exp $

--- client/client.c.orig	Wed Apr 18 00:00:52 2001
+++ client/client.c
@@ -1180,7 +1180,7 @@
 				"find . -name \"%s\" -print > %s",p,tmpname);
 		else
 			slprintf(cmd,sizeof(pstring)-1,
-				"find . -maxdepth 1 -name \"%s\" -print > %s",p,tmpname);
+				"ls -1 %s > %s",p,tmpname);
 		system(cmd);
 		close(fd);
 
@@ -1615,22 +1615,19 @@
 	return True;
 }
 
-#if defined(HAVE_LIBREADLINE)
+#if defined(HAVE_READLINE)
 #  if defined(HAVE_READLINE_HISTORY_H) || defined(HAVE_HISTORY_H)
 /****************************************************************************
 history
 ****************************************************************************/
 static void cmd_history(void)
 {
-	HIST_ENTRY **hlist;
 	register int i;
 
-	hlist = history_list ();	/* Get pointer to history list */
-	
-	if (hlist)			/* If list not empty */
+	if (history_length)		/* If history is not empty */
 	{
-		for (i = 0; hlist[i]; i++)	/* then display it */
-			DEBUG(0, ("%d: %s\n", i, hlist[i]->line));
+		for (i = 1; i <= history_length; i++)	/* then display it */
+			DEBUG(0, ("%d: %s\n", i, history_get(i)->line));
 	}
 }
 #  endif 
@@ -1691,7 +1688,7 @@
   {"setmode",cmd_setmode,"filename <setmode string> change modes of file",{COMPL_REMOTE,COMPL_NONE}},
   {"help",cmd_help,"[command] give help on a command",{COMPL_NONE,COMPL_NONE}},
   {"?",cmd_help,"[command] give help on a command",{COMPL_NONE,COMPL_NONE}},
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
   {"history",cmd_history,"displays the command history",{COMPL_NONE,COMPL_NONE}},
 #endif
   {"!",NULL,"run a shell command on the local system",{COMPL_NONE,COMPL_NONE}},
@@ -1751,7 +1748,7 @@
 	}
 }
 
-#ifndef HAVE_LIBREADLINE
+#ifndef HAVE_READLINE
 /****************************************************************************
 wait for keyboard activity, swallowing network packets
 ****************************************************************************/
@@ -1830,7 +1827,7 @@
 	pstring line;
 	char *ptr;
 
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
 /* Minimal readline support, 29Jun1999, s.xenitellis@rhbnc.ac.uk */
 #ifdef PROMPTSIZE
 #undef PROMPTSIZE
@@ -1844,7 +1841,7 @@
 	while (!feof(stdin)) {
 		fstring tok;
 		int i;
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
 		if ( temp != (char *)NULL )
 		{
 			free( temp );	/* Free memory allocated every time by readline() */
@@ -2231,7 +2228,7 @@
 
 	DEBUGLEVEL = 2;
 
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
 	/* Allow conditional parsing of the ~/.inputrc file. */
 	rl_readline_name = "smbclient";
 #endif    
