$NetBSD: patch-ae,v 1.6 2001/06/19 08:48:57 jlam Exp $

--- Makefile.in.orig	Wed Dec 29 17:02:40 1999
+++ Makefile.in
@@ -63,17 +63,17 @@
 TERMCAP_LIB = @TERMCAP_LIB@
 
 # For libraries which include headers from other libraries.
-INCLUDES = -I. -I$(srcdir) -I$(includedir)
+INCLUDES = -I. -I$(srcdir)
 
 CCFLAGS = $(DEFS) $(LOCAL_DEFS) $(CPPFLAGS) $(INCLUDES) $(LOCAL_CFLAGS) $(CFLAGS)
 
 .c.o:
 	${RM} $@
-	$(CC) -c $(CCFLAGS) $<
+	${LIBTOOL} --mode=compile $(CC) -c $(CCFLAGS) $<
 
 # The name of the main library target.
-LIBRARY_NAME = libreadline.a
-STATIC_LIBS = libreadline.a libhistory.a
+LIBRARY_NAME = libreadline.la
+STATIC_LIBS = libreadline.la libhistory.la
 
 # The C code source files for this library.
 CSOURCES = $(srcdir)/readline.c $(srcdir)/funmap.c $(srcdir)/keymaps.c \
@@ -121,18 +121,17 @@
 
 static: $(STATIC_LIBS)
 
-libreadline.a: $(OBJECTS)
+libreadline.la: $(OBJECTS)
 	$(RM) $@
-	$(AR) $(ARFLAGS) $@ $(OBJECTS)
-	-test -n "$(RANLIB)" && $(RANLIB) $@
+	${LIBTOOL} --mode=link cc -o $@ ${OBJECTS:.o=.lo} -rpath ${PREFIX}/lib -version-info ${READLINE_MAJOR}:${READLINE_MINOR}
 
-libhistory.a: $(HISTOBJ) xmalloc.o
+libhistory.la: $(HISTOBJ) xmalloc.o
 	$(RM) $@
-	$(AR) $(ARFLAGS) $@ $(HISTOBJ) xmalloc.o
-	-test -n "$(RANLIB)" && $(RANLIB) $@
+	${LIBTOOL} --mode=link cc -o $@ ${HISTOBJ:.o=.lo} xmalloc.lo -rpath ${PREFIX}/lib -version-info ${READLINE_MAJOR}:${READLINE_MINOR}
 
-readline: $(OBJECTS) readline.h rldefs.h chardefs.h ./libreadline.a
-	$(CC) $(CCFLAGS) -o $@ ./examples/rl.c ./libreadline.a ${TERMCAP_LIB}
+
+readline: $(OBJECTS) readline.h rldefs.h chardefs.h ./libreadline.la
+	${LIBTOOL} --mode=link $(CC) $(CCFLAGS) ${LDFLAGS} -o $@ ./examples/rl.c libreadline.la -ltermcap
 
 Makefile makefile: config.status $(srcdir)/Makefile.in
 	CONFIG_FILES=Makefile CONFIG_HEADERS= $(SHELL) ./config.status
@@ -181,12 +180,8 @@
 maybe-uninstall-headers: uninstall-headers
 
 install: installdirs $(STATIC_LIBS) install-headers
-	-$(MV) $(libdir)/libreadline.a $(libdir)/libreadline.old
-	$(INSTALL_DATA) libreadline.a $(libdir)/libreadline.a
-	-test -n "$(RANLIB)" && $(RANLIB) -t $(libdir)/libreadline.a
-	-$(MV) $(libdir)/libhistory.a $(libdir)/libhistory.old
-	$(INSTALL_DATA) libhistory.a $(libdir)/libhistory.a
-	-test -n "$(RANLIB)" && $(RANLIB) -t $(libdir)/libhistory.a
+	${LIBTOOL} --mode=install ${INSTALL_DATA} libreadline.la ${libdir}
+	${LIBTOOL} --mode=install ${INSTALL_DATA} libhistory.la ${libdir}
 	-( if test -d doc ; then \
 		cd doc && \
 		${MAKE} ${MFLAGS} infodir=$(infodir) $@; \
