$NetBSD: patch-au,v 1.3 2000/10/18 03:31:17 hubertf Exp $

--- src/commit.c.orig	Wed Jul 26 21:29:01 2000
+++ src/commit.c
@@ -996,7 +996,9 @@
 		  xmalloc (sizeof (struct logfile_info)));
 	    li->type = status;
 	    li->tag = xstrdup (vers->tag);
-	    li->rev_old = xstrdup (vers->vn_rcs);
+	    /* If the file was re-added, we want the revision in the commitlog
+	       to be NONE, not the previous dead revision. */
+	    li->rev_old = status == T_ADDED ? NULL : xstrdup (vers->vn_rcs);
 	    li->rev_new = NULL;
 	    p->data = (char *) li;
 	    (void) addnode (ulist, p);
@@ -1497,7 +1499,7 @@
 		run_print (stdout);
 		cvs_output ("'\n", 0);
 		cvs_flushout ();
-		(void) run_exec (RUN_TTY, RUN_TTY, RUN_TTY, RUN_NORMAL);
+		(void) run_exec (RUN_TTY, RUN_TTY, RUN_TTY, RUN_NORMAL | RUN_UNSETXID);
 		free (repos);
 	    }
 	    else
