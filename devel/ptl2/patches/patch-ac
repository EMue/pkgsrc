$NetBSD: patch-ac,v 1.3 1999/05/06 20:07:22 tv Exp $

--- Util/Makefile.in.orig	Thu Mar 25 07:51:18 1999
+++ Util/Makefile.in	Thu May  6 11:32:11 1999
@@ -264,10 +264,14 @@
 
 .SUFFIXES: .po
 
+LIBSTUFF=$(LIBRARY_OBJS_PIC) libc_r/*.po net_r/*.po $(altsysdir)/*.po
 $(SHARED_LIBRARY) : $(LIBRARY_OBJS_PIC) libc_r net_r
 	@echo "Loading $@ ... "
-	$(MKSHLIBCMD) -o $@ $(LIBRARY_OBJS_PIC) libc_r/*.po net_r/*.po $(altsysdir)/*.po
-	-ln -s $@ $@.$(SLIBVER)
+	@if [ -f /usr/lib/crtbeginS.o ]; then \
+		$(MKSHLIBCMD) -o $@.$(SLIBVER) -soname libPTL.so.1 /usr/lib/crtbeginS.o $(LIBSTUFF) /usr/lib/crtendS.o; \
+	else \
+		$(MKSHLIBCMD) -o $@.$(SLIBVER) /usr/lib/c++rt0.o $(LIBSTUFF); \
+	fi
 	@echo done
 
 .c.po:
@@ -432,14 +436,10 @@
 	@$(utildir)/banner "copying $(MERGED_LIBRARY) to $(dest_libdir)"
 	$(INSTALL_DATA) $(MERGED_LIBRARY) $(dest_libdir)
 	$(RANLIB) $(dest_libdir)/$(MERGED_LIBRARY)
-	if [ -f $(SHARED_LIBRARY) ]; then \
-		$(INSTALL_DATA) $(SHARED_LIBRARY) $(dest_libdir) ;\
-		(cd $(dest_libdir); \
-		rm -f $(SHARED_LIBRARY).$(SLIBVER) ; \
-		ln -s $(SHARED_LIBRARY) $(SHARED_LIBRARY).$(SLIBVER) ) ; \
-	fi
+	$(INSTALL_DATA) $(SHARED_LIBRARY).$(SLIBVER) $(dest_libdir)
 	$(INSTALL_DATA) specs $(dest_specsdir)
-	$(INSTALL_PROGRAM) ptlgcc $(dest_bindir)
+	sed -e 's,gcc ,g\+\+ ,' ptlgcc >ptlg++
+	$(INSTALL_PROGRAM) ptlgcc ptlg++ $(dest_bindir)
 
 clean : libaltsys-clean
 	-rm -rf *.o *.po core config.h libc_r net_r \
