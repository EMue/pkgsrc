$NetBSD: patch-ac,v 1.6 2001/02/11 10:12:04 skrll Exp $

--- config.guess.orig	Fri May 26 18:30:02 2000
+++ config.guess
@@ -76,33 +76,24 @@
 	# compatibility and a consistent mechanism for selecting the
 	# object file format.
 	# Determine the machine/vendor (is the vendor relevant).
-	case "${UNAME_MACHINE}" in
-	    amiga) machine=m68k-cbm ;;
-	    arm32) machine=arm-unknown ;;
-	    atari*) machine=m68k-atari ;;
-	    sun3*) machine=m68k-sun ;;
-	    mac68k) machine=m68k-apple ;;
-	    macppc) machine=powerpc-apple ;;
-	    hp3[0-9][05]) machine=m68k-hp ;;
-	    ibmrt|romp-ibm) machine=romp-ibm ;;
-	    *) machine=${UNAME_MACHINE}-unknown ;;
+	PATH=$PATH:/sbin:/usr/sbin
+	UNAME_MACHINE_ARCH=`(uname -p || sysctl -n hw.machine_arch || echo unknown) 2>/dev/null`
+	case "${UNAME_MACHINE_ARCH}:${UNAME_RELEASE}" in
+	    arm26:*)			UNAME_MACHINE_ARCH=armv2;;
+	    arm32:*)			UNAME_MACHINE_ARCH=arm;;
+	    mips:*)			UNAME_MACHINE_ARCH=mipsel;;
+	    i386:*|m68k:*|ns32k:*|sparc:*|vax:*)
+		# The Operating System including object format.
+		if echo __ELF__ | $CC_FOR_BUILD -E - | grep -q __ELF__; then
+		    UNAME_OBJFORMAT=
+		else
+		    UNAME_OBJFORMAT=elf
+		fi;;
 	esac
-	# The Operating System including object format.
-	if echo __ELF__ | $CC_FOR_BUILD -E - 2>/dev/null \
-		| grep __ELF__ >/dev/null
-	then
-	    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
-	    # Return netbsd for either.  FIX?
-	    os=netbsd
-	else
-	    os=netbsdelf
-	fi
-	# The OS release
-	release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
 	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
-	echo "${machine}-${os}${release}"
+	echo ${UNAME_MACHINE_ARCH}-netbsd${UNAME_OBJFORMAT}`echo ${UNAME_RELEASE} | sed -e 's/[-_].*/\./'`
 	exit 0 ;;
     alpha:OSF1:*:*)
 	if test $UNAME_RELEASE = "V4.0"; then
