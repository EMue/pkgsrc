$NetBSD: patch-ab,v 1.7 1999/09/24 00:39:13 jlam Exp $

--- configure.orig	Thu Feb 12 18:46:01 1998
+++ configure	Thu Sep 23 16:45:08 1999
@@ -1628,6 +1628,7 @@
     test -z "$cf_dir" && cf_dir=/usr/man
     cf_rename=""
     cf_format=no
+    if false; then	# install unformatted man pages
     for cf_name in $cf_dir/*/date.[01]* $cf_dir/*/date
     do
        cf_test=`echo $cf_name | sed -e 's/*//'`
@@ -1641,6 +1642,8 @@
 	  break
        fi
     done
+    else cf_form=cat
+    fi
     if test "$cf_form" != "unknown" ; then
        break
     fi
@@ -2103,7 +2106,7 @@
 
 	
 	case $DFT_LWR_MODEL in
-	normal)  DFT_DEP_SUFFIX='.a'   ;;
+	normal)  DFT_DEP_SUFFIX='.la'   ;;
 	debug)   DFT_DEP_SUFFIX='_g.a' ;;
 	profile) DFT_DEP_SUFFIX='_p.a' ;;
 	shared)
@@ -5310,7 +5313,8 @@
 
 # dependencies and linker-arguments for test-programs
 TEST_DEPS="${LIB_PREFIX}${LIB_NAME}${DFT_DEP_SUFFIX} $TEST_DEPS"
-TEST_ARGS="-l${LIB_NAME}${DFT_ARG_SUFFIX} $TEST_ARGS"
+TEST_ARGS="${LIB_PREFIX}${LIB_NAME}${DFT_DEP_SUFFIX} $TEST_ARGS"
+
 
 # dependencies and linker-arguments for utility-programs
 PROG_ARGS="$TEST_ARGS"
@@ -5353,16 +5357,16 @@
 EOF
 
 			TEST_DEPS="${LIB_PREFIX}${cf_dir}${DFT_DEP_SUFFIX} $TEST_DEPS"
-			TEST_ARGS="-l${cf_dir}${DFT_ARG_SUFFIX} $TEST_ARGS"
+			TEST_ARGS="${LIB_PREFIX}${cf_dir}${DFT_DEP_SUFFIX} $TEST_ARGS"
 		fi
 	fi
 done
 echo "$ac_t""$cf_cv_src_modules" 1>&6
-TEST_ARGS="-L${LIB_DIR} -L\$(libdir) $TEST_ARGS"
-
-
 
-PROG_ARGS="-L${LIB_DIR} -L\$(libdir) $PROG_ARGS"
+# Put $(libdir) last so we ensure programs are linked against newly-built
+# versions of libraries.
+TEST_ARGS="$TEST_ARGS -L\$(libdir)"
+PROG_ARGS="$PROG_ARGS -L\$(libdir)"
 
 
 SRC_SUBDIRS="man include"
@@ -5371,7 +5375,7 @@
 	SRC_SUBDIRS="$SRC_SUBDIRS $cf_dir"
 done
 SRC_SUBDIRS="$SRC_SUBDIRS misc test"
-test $cf_cxx_library != no && SRC_SUBDIRS="$SRC_SUBDIRS c++"
+test "X$cf_with_cxx" != Xno && SRC_SUBDIRS="$SRC_SUBDIRS c++"
 
 ADA_SUBDIRS=
 if test "$ac_cv_prog_gnat_correct" = yes && test -d $srcdir/Ada95; then
@@ -5888,7 +5892,7 @@
 			
 	
 	case $cf_item in
-	normal)  cf_suffix='.a'   ;;
+	normal)  cf_suffix='.la'   ;;
 	debug)   cf_suffix='_g.a' ;;
 	profile) cf_suffix='_p.a' ;;
 	shared)
@@ -5931,7 +5935,7 @@
 			
 	
 	case $cf_item in
-	normal)  cf_suffix='.a'   ;;
+	normal)  cf_suffix='.la'   ;;
 	debug)   cf_suffix='_g.a' ;;
 	profile) cf_suffix='_p.a' ;;
 	shared)
@@ -6120,7 +6124,7 @@
 		for i in `cat $srcdir/$cf_dir/headers |fgrep -v "#"`
 		do
 			echo "	@ (cd \$(INSTALL_PREFIX)\$(includedir) && rm -f `basename $i`) ; ../headers.sh \$(INSTALL_DATA) \$(INSTALL_PREFIX)\$(includedir) \$(srcdir) $i" >>$cf_dir/Makefile
-			test $i = curses.h && echo "	@ (cd \$(INSTALL_PREFIX)\$(includedir) && rm -f ncurses.h && \$(LN_S) curses.h ncurses.h)" >>$cf_dir/Makefile
+			test $i = curses.h && echo "	@ (cd \$(INSTALL_PREFIX)\$(includedir) && rm -f ncurses.h && mv -f curses.h ncurses.h)" >>$cf_dir/Makefile
 		done
 
 	cat >>$cf_dir/Makefile <<CF_EOF
