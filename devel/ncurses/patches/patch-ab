$NetBSD: patch-ab,v 1.8 2000/01/15 18:39:29 jlam Exp $

--- configure.orig	Sat Oct 23 20:33:18 1999
+++ configure	Sat Jan 15 11:24:46 2000
@@ -2461,7 +2461,7 @@
 
 	
 	case $DFT_LWR_MODEL in
-	normal)  DFT_DEP_SUFFIX='.a'   ;;
+	normal)  DFT_DEP_SUFFIX='.la'  ;;
 	debug)   DFT_DEP_SUFFIX='_g.a' ;;
 	profile) DFT_DEP_SUFFIX='_p.a' ;;
 	shared)
@@ -2581,6 +2581,9 @@
 
 	cf_cv_rm_so_locs=no
 
+LINK_PROGS='$(LIBTOOL)'
+LINK_TESTS='$(LIBTOOL)'
+
 	case $cf_cv_system_name in
 	hpux10.*)
 		# (tested with gcc 2.7.2 -- I don't have c89)
@@ -6440,7 +6443,7 @@
 ### could override this.
 if test "$with_termlib" = yes ; then
 	TEST_DEPS="${LIB_PREFIX}${TINFO_NAME}${DFT_DEP_SUFFIX}"
-	TEST_ARGS="-l${TINFO_NAME}${DFT_ARG_SUFFIX}"
+	TEST_ARGS="${LIB_PREFIX}${TINFO_NAME}${DFT_DEP_SUFFIX}"
 fi
 PROG_DEPS="$TEST_DEPS"
 PROG_ARGS="$TEST_ARGS"
@@ -6454,7 +6457,7 @@
 
 # dependencies and linker-arguments for test-programs
 TEST_DEPS="${LIB_PREFIX}${LIB_NAME}${DFT_DEP_SUFFIX} $TEST_DEPS"
-TEST_ARGS="-l${LIB_NAME}${DFT_ARG_SUFFIX} $TEST_ARGS"
+TEST_ARGS="${LIB_PREFIX}${LIB_NAME}${DFT_DEP_SUFFIX} $TEST_ARGS"
 
 # dependencies and linker-arguments for utility-programs
 PROG_ARGS="$TEST_ARGS"
@@ -6497,16 +6500,17 @@
 EOF
 
 			TEST_DEPS="${LIB_PREFIX}${cf_dir}${DFT_DEP_SUFFIX} $TEST_DEPS"
-			TEST_ARGS="-l${cf_dir}${DFT_ARG_SUFFIX} $TEST_ARGS"
+			TEST_ARGS="${LIB_PREFIX}${cf_dir}${DFT_DEP_SUFFIX} $TEST_ARGS"
 		fi
 	fi
 done
 echo "$ac_t""$cf_cv_src_modules" 1>&6
-TEST_ARGS="-L${LIB_DIR} -L\$(libdir) $TEST_ARGS"
-
 
-
-PROG_ARGS="-L${LIB_DIR} -L\$(libdir) $PROG_ARGS"
+# Put $(libdir) last so we ensure programs are linked against newly-built
+# versions of libraries.
+#
+TEST_ARGS="$TEST_ARGS -L\$(libdir)"
+PROG_ARGS="$PROG_ARGS -L\$(libdir)"
 
 
 SRC_SUBDIRS="man include"
@@ -7048,7 +7052,7 @@
 			
 	
 	case $cf_item in
-	normal)  cf_suffix='.a'   ;;
+	normal)  cf_suffix='.la'  ;;
 	debug)   cf_suffix='_g.a' ;;
 	profile) cf_suffix='_p.a' ;;
 	shared)
@@ -7098,7 +7102,7 @@
 			
 	
 	case $cf_item in
-	normal)  cf_suffix='.a'   ;;
+	normal)  cf_suffix='.la'  ;;
 	debug)   cf_suffix='_g.a' ;;
 	profile) cf_suffix='_p.a' ;;
 	shared)
@@ -7296,7 +7300,7 @@
 		for i in `cat $srcdir/$cf_dir/headers |fgrep -v "#"`
 		do
 			echo "	@ (cd \$(INSTALL_PREFIX)\$(includedir) && rm -f `basename $i`) ; ../headers.sh \$(INSTALL_DATA) \$(INSTALL_PREFIX)\$(includedir) \$(srcdir) $i" >>$cf_dir/Makefile
-			test $i = curses.h && echo "	@ (cd \$(INSTALL_PREFIX)\$(includedir) && rm -f ncurses.h && \$(LN_S) curses.h ncurses.h)" >>$cf_dir/Makefile
+			test $i = curses.h && echo "	@ (cd \$(INSTALL_PREFIX)\$(includedir) && rm -f ncurses.h && mv -f curses.h ncurses.h)" >>$cf_dir/Makefile
 		done
 
 	cat >>$cf_dir/Makefile <<CF_EOF
