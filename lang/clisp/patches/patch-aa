$NetBSD: patch-aa,v 1.7 2000/05/27 02:47:14 wiz Exp $

--- makemake.in.orig	Thu May 25 16:35:13 2000
+++ makemake.in	Thu May 25 16:51:16 2000
@@ -317,7 +317,7 @@
      LIBDL='@LIBDL@'                     # either '-ldl' or ''
      LIBICONV='@LIBICONV@'               # either '-liconv' or ''
      X_INCLUDES='@X_INCLUDES@'           # either '-I/usr/somewhere/include' or ''
-     X_LIBS='@X_LIBS@'                   # either '-L/usr/somewhere/lib -lX11' or ''
+     X_LIBS='-Wl,-rpath ${X11BASE}/lib @X_LIBS@' # either '-L/usr/somewhere/lib -lX11' or ''
      host='@host@'                       # something like 'sparc-sun-sunos4'
      host_cpu='@host_cpu@'               # something like 'sparc'
      host_vendor='@host_vendor@'         # something like 'sun'
@@ -1118,6 +1118,9 @@
   esac
 fi
 
+if [ "$TSYSOS" = "netbsd" ] ; then # NetBSD
+       XCFLAGS=$XCFLAGS' -DNO_GENERATIONAL_GC -fpcc-struct-return -Dunix'
+fi
 if [ $TSYS = sun4 -a $CROSS = false ] ; then
   ARCH_K=`(arch -k) 2>/dev/null || uname -m 2>/dev/null` # kernel architecture, see arch(1)
   if [ "$ARCH_K" = sun4 -o "$ARCH_K" = sun4c -o "$ARCH_K" = sun4e ] ; then
@@ -1623,7 +1626,7 @@
 echol "dvidir = \$(exec_prefix)${NEXT_}share${NEXT_}dvi"
 case "$fsstnd" in
   gnu_ext)
-    echol "docdir = \$(exec_prefix)${NEXT_}doc"
+    echol "docdir = \$(exec_prefix)${NEXT_}share${NEXT_}doc"
     echol "lispdocdir = \$(docdir)${NEXT_}clisp"
     ;;
   suse)
@@ -2533,7 +2536,7 @@
   if [ $HOS = unix ] ; then
     echotab "if test -d locale; then rm -rf locale; fi"
     echotab "mkdir locale"
-    echotab "(cd gettext/po && \$(MAKE) && \$(MAKE) install datadir=../.. localedir='\$\$(datadir)/locale' INSTALL_DATA=ln) || (rm -rf locale ; exit 1)"
+    echotab "(cd gettext/po && \$(MAKE) && \$(MAKE) install datadir=../.. localedir='\$\$(datadir)/locale' INSTALL_DATA=\"ln -f\") || (rm -rf locale ; exit 1)"
   else
     echotab "mkdir locale"
     eval `grep ALL_LINGUAS= src/gettext/configure.in`
@@ -3130,13 +3133,11 @@
     case "$fsstnd" in
       gnu_ext)
         echotab "if [ ! -d \$(install_root)\$(exec_prefix)/share ] ; then mkdir \$(install_root)\$(exec_prefix)/share ; fi"
-        echotab "if [ ! -d \$(install_root)\$(htmldir) ] ; then mkdir \$(install_root)\$(htmldir) ; fi"
-        echotab "if [ ! -d \$(install_root)\$(dvidir) ] ; then mkdir \$(install_root)\$(dvidir) ; fi"
+        echotab "if [ ! -d \$(prefix)/share/doc/clisp ] ; then mkdir \$(prefix)/share/doc/clisp ; fi"
         ;;
     esac
     echotab "if [ ! -d \$(install_root)\$(docdir) ] ; then mkdir \$(install_root)\$(docdir) ; fi"
     echotab "if [ ! -d \$(install_root)\$(lispdocdir) ] ; then mkdir \$(install_root)\$(lispdocdir) ; fi"
-    echotab "if [ ! -d \$(install_root)\$(lispdocdir)/doc ] ; then mkdir \$(install_root)\$(lispdocdir)/doc ; fi"
     echol
     echol "install-bin : lisp${LEXE} lispinit.mem clisp.c force"
     echotab "if [ ! -d \$(install_root)\$(prefix) ] ; then mkdir \$(install_root)\$(prefix) ; fi"
@@ -3178,17 +3179,10 @@
     case "$fsstnd" in
       gnu_ext)
         echotab "if [ ! -d \$(install_root)\$(exec_prefix)/share ] ; then mkdir \$(install_root)\$(exec_prefix)/share ; fi"
-        echotab "if [ ! -d \$(install_root)\$(htmldir) ] ; then mkdir \$(install_root)\$(htmldir) ; fi"
-        echotab "\$(INSTALL_DATA) clisp.html \$(install_root)\$(htmldir)/clisp.html"
+        echotab "if [ ! -d \$(install_root)\$(prefix)/share/doc/clisp ] ; then mkdir \$(install_root)\$(prefix)/share/doc/clisp ; fi"
+        echotab "\$(INSTALL_DATA) clisp.html \$(install_root)\$(prefix)/share/doc/clisp/clisp.html"
         if [ $TERMINAL = readline ] ; then
-          echotab "\$(INSTALL_DATA) clreadline.html \$(install_root)\$(htmldir)/clreadline.html"
-        fi
-        echotab "if [ ! -d \$(install_root)\$(dvidir) ] ; then mkdir \$(install_root)\$(dvidir) ; fi"
-        if test -n "$GROFF"; then
-          echotab "\$(INSTALL_DATA) clisp.dvi \$(install_root)\$(dvidir)/clisp.dvi"
-        fi
-        if [ $TERMINAL = readline ] ; then
-          echotab "\$(INSTALL_DATA) clreadline.dvi \$(install_root)\$(dvidir)/clreadline.dvi"
+          echotab "\$(INSTALL_DATA) clreadline.html \$(install_root)\$(prefix)/share/doc/clisp/clreadline.html"
         fi
         ;;
     esac
@@ -3198,9 +3192,8 @@
     echotab "if [ ! -d \$(install_root)\$(exec_prefix) ] ; then mkdir \$(install_root)\$(exec_prefix) ; fi"
     echotab "if [ ! -d \$(install_root)\$(docdir) ] ; then mkdir \$(install_root)\$(docdir) ; fi"
     echotab "if [ ! -d \$(install_root)\$(lispdocdir) ] ; then mkdir \$(install_root)\$(lispdocdir) ; fi"
-    echotab "if [ ! -d \$(install_root)\$(lispdocdir)/doc ] ; then mkdir \$(install_root)\$(lispdocdir)/doc ; fi"
     echotab "\$(INSTALL_DATA) \$(READMES) \$(install_root)\$(lispdocdir)/"
-    echotab "\$(INSTALL_DATA) \$(MANUALS)${manual_dvi} \$(install_root)\$(lispdocdir)/doc/"
+    echotab "\$(INSTALL_DATA) \$(MANUALS)${manual_dvi} \$(install_root)\$(lispdocdir)/"
     echol
     echol
     echol "installcheck : ${TESTSDIR} force"
@@ -3227,18 +3220,13 @@
     fi
     case "$fsstnd" in
       gnu_ext)
-        echotab "\$(RM) \$(install_root)\$(htmldir)/clisp.html"
-        if [ $TERMINAL = readline ] ; then
-          echotab "\$(RM) \$(install_root)\$(htmldir)/clreadline.html"
-        fi
-        echotab "\$(RM) \$(install_root)\$(dvidir)/clisp.dvi"
         if [ $TERMINAL = readline ] ; then
-          echotab "\$(RM) \$(install_root)\$(dvidir)/clreadline.dvi"
+          echotab "\$(RM) \$(install_root)\$(prefix)/share/doc/clisp/clreadline.html"
         fi
         ;;
     esac
     echotab "for f in \$(READMES); do \$(RM) \$(install_root)\$(lispdocdir)/\$\$f; done"
-    echotab "for f in \$(MANUALS)${manual_dvi}; do \$(RM) \$(install_root)\$(lispdocdir)/doc/\$\$f; done"
+    echotab "for f in \$(MANUALS)${manual_dvi}; do \$(RM) \$(install_root)\$(lispdocdir)/\$\$f; done"
     echol
     echol
   fi
