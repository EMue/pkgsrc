$NetBSD: patch-ab,v 1.2 2000/01/22 13:31:45 itojun Exp $

--- configure.in.orig	Tue Dec  7 16:01:00 1999
+++ configure.in	Fri Jan 21 00:56:42 2000
@@ -355,6 +355,9 @@
   else
     LDFLAGS="-rdynamic"
   fi;;
+netbsd*)
+        rb_cv_netbsd_elf=`echo|cc -E -v - 2>&1 |grep __ELF__`
+	;;
 esac
 
 AC_SUBST(DLDFLAGS)dnl
@@ -430,10 +433,9 @@
 			fi
 			rb_cv_dlopen=yes ;;
 	netbsd*)  	LDSHARED="ld -shared"
-                      	case "$host_cpu" in
-                      	alpha)
-                          LDFLAGS="-export-dynamic" ;;
-                      	esac
+			if test "x$rb_cv_netbsd_elf" != "x" ; then
+                          LDFLAGS="-export-dynamic"
+                      	fi
 			rb_cv_dlopen=yes ;;
 	openbsd*) 	LDSHARED="ld -Bforcearchive -Bshareable"
 			rb_cv_dlopen=yes ;;
@@ -684,11 +686,12 @@
 	;;
     netbsd*)
 	LIBRUBY_SO='lib$(RUBY_INSTALL_NAME).so.$(MAJOR).$(MINOR)'
- 	case "$host_cpu" in
-	alpha|mipsel|mipseb|powerpc|sparc64)  # ELF platforms
-	   LIBRUBY_ALIASES='lib$(RUBY_INSTALL_NAME).so.$(MAJOR) lib$(RUBY_INSTALL_NAME).so' ;;
- 	*) LIBRUBY_ALIASES= ;;  # a.out platforms
-	esac
+        if test "x$rb_cv_netbsd_elf" != "x" ; then
+	   LIBRUBYARG='$(LIBRUBY_SO)'
+	   LIBRUBY_ALIASES='lib$(RUBY_INSTALL_NAME).so.$(MAJOR) lib$(RUBY_INSTALL_NAME).so'
+	else
+ 	   LIBRUBY_ALIASES=''
+	fi
  	;;
     solaris*)
 	XLDFLAGS='-R${prefix}/lib'
