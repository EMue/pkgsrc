#!/bin/sh
#
# $NetBSD: pkgdiff,v 1.3 2000/08/15 14:35:23 abs Exp $
#
# Id: pkgdiff,v 1.4 2000/05/14 01:04:54 feyrer Exp feyrer 
#
# Usage: pkgdiff oldfile newfile
#
# Will output a patch ready for the NetBSD Pkgs Collection (unified
# diff, plus no RCS IDs if possible). 
#
# Copyright (c) 2000 by Hubert Feyrer <hubertf@netbsd.org>
# All Rights Reserved.  Absolutely no warranty.  
#

if [ $# -le 1 ]
then
	echo $0: need at least two arguments >&2
	exit 1;
fi

lines=3
while [ `diff -u -$lines "$@" | egrep -c '\\$(NetBSD|Author|Date|Header|Id|Locker|Log|Name|RCSfile|Revision|Source|State)'`  !=  0 ]
do
	lines=`expr $lines - 1`
	if [ $lines = 0 ]; then
		echo "Cannot strip away RCS IDs, please handle manually!"
		exit 1
	fi
done

if ! diff -qu -$lines "$@" > /dev/null
then
    echo '$'NetBSD'$'
    echo ''
    # Strip out the date on the +++ line to reduce needless
    # differences in regenerated patches
    diff -u -$lines "$@" | sed -e 's:^\(+++ [^	]*\)	.*:\1:'
fi
