#!/bin/sh
#
# Upload non-restricted binary pkgs to ftp server
# Must be called in /usr/pkgsrc
#

# Pull in RSYNC_DST, RSYNC_OPTS:
if [ -f "$BULK_BUILD_CONF" ]; then
    . $BULK_BUILD_CONF
else
    . `dirname $0`/build.conf
fi

# May be different than $USR_PKGSRC:
pkgsrcdir=`cd pkgtools/pkglint ; make show-var VARNAME=PKGSRCDIR`
packages=`cd pkgtools/pkglint ; make show-var VARNAME=PACKAGES`

# Pull in some pkgs needed
( cd pkgtools/pkglint ; make bulk-install )
( cd net/rsync ;        make bulk-install )

lintpkgsrc -P $pkgsrcdir -pR  | sed 's@'$packages'/@@' > /tmp/r.$$

cd $packages
rsync \
	-vap \
	$RSYNC_OPTS \
	--exclude-from=/tmp/r.$$ \
	. $RSYNC_DST

rm /tmp/r.$$
