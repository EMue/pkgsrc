# New ports collection makefile for:	rplay - Network audio player   
# Version required:     3.2.0b6
# Date created:		16 March 1995  
# Whom:			rmallory@csusb.edu
#
# $NetBSD: Makefile,v 1.3 1998/01/23 16:58:49 hubertf Exp $
# FreeBSD Id: Makefile,v 1.8 1997/06/13 16:17:01 ache Exp
#

DISTNAME=       rplay-3.2.0b6
CATEGORIES=	audio
MASTER_SITES=	ftp://ftp.sdsu.edu/pub/rplay/

MAINTAINER=	rmallory@csusb.edu

LIB_DEPENDS=    gsm\\.1\\.0:${PORTSDIR}/audio/gsm
BUILD_DEPENDS=  ${PREFIX}/bin/install-info:${PORTSDIR}/devel/gtexinfo
RUN_DEPENDS=    ${PREFIX}/bin/install-info:${PORTSDIR}/devel/gtexinfo

HAS_CONFIGURE=	yes
CONFIGURE_ARGS= "--prefix=$(PREFIX)"
CONFIGURE_ENV+=        RPLAY_TARGET=generic # XXX
CONFIGURE_ENV+=        CFLAGS=-I$(PREFIX)/include # XXX
CONFIGURE_ENV+=        LDFLAGS=-L$(PREFIX)/lib # XXX
#USE_GMAKE=	yes
MAN1=           rplay.1 xrplay.1 rplayd.1 rptp.1
MAN5=		rplay.conf.5 rplay.hosts.5 rplay.servers.5

pre-configure:
	for f in `find ${WRKDIR} -type f -print|xargs $[GREP} -l '/usr/local'`; do \
		${SED} -e 's:/usr/local:'${PREFIX}':g' < $$f > $$f.pdone && ${MV} $$f.pdone $$f; \
	done
	chmod +x ${WRKSRC}/configure

post-build:
	cd ${WRKSRC}/doc ; make info

post-install:
	@if [ ! -f ${PREFIX}/etc/rc.d/rplayd.sh ]; then \
		${ECHO} "Installing ${PREFIX}/etc/rc.d/rplayd.sh startup file."; \
		${ECHO} "#!/bin/sh" > ${PREFIX}/etc/rc.d/rplayd.sh; \
		${ECHO} "[ -x ${PREFIX}/sbin/rplayd ] && ( ${PREFIX}/sbin/rplayd & ) && ${ECHO} -n ' rplayd'" >> ${PREFIX}/etc/rc.d/rplayd.sh; \
		chmod 751 ${PREFIX}/etc/rc.d/rplayd.sh; \
	fi
	@if [ ! -f ${PREFIX}/etc/rplay.hosts ]; then \
		${ECHO} localhost > ${PREFIX}/etc/rplay.hosts; \
	fi
	install-info ${PREFIX}/info/RPTP.info ${PREFIX}/info/dir
	install-info ${PREFIX}/info/RPLAY.info ${PREFIX}/info/dir
	install-info ${PREFIX}/info/rplay.info ${PREFIX}/info/dir
	install-info ${PREFIX}/info/librplay.info ${PREFIX}/info/dir

.include <bsd.port.mk>
