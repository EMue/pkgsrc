$NetBSD: patch-am,v 1.2 2000/08/29 17:08:38 abs Exp $

--- faxd/tif_fax3.h.orig	Mon Oct 12 21:47:49 1998
+++ faxd/tif_fax3.h
@@ -327,6 +327,10 @@
 		goto doneWhite1d;					\
 	    case S_MakeUpW:						\
 	    case S_MakeUp:						\
+		if (!TabEnt->Param) {					\
+		    unexpected("WhiteTable Zero-length", a0);		\
+		    goto done1d;					\
+		}							\
 		a0 += TabEnt->Param;					\
 		RunLength += TabEnt->Param;				\
 		break;							\
@@ -349,6 +353,10 @@
 		goto doneBlack1d;					\
 	    case S_MakeUpB:						\
 	    case S_MakeUp:						\
+		if (!TabEnt->Param) {					\
+		    unexpected("BlackTable Zero-length", a0);		\
+		    goto done1d;					\
+		}							\
 		a0 += TabEnt->Param;					\
 		RunLength += TabEnt->Param;				\
 		break;							\
@@ -404,6 +412,8 @@
 			goto doneWhite2da;				\
 		    case S_MakeUpB:					\
 		    case S_MakeUp:					\
+			if (!TabEnt->Param)				\
+			    goto zeroBlack2d;				\
 			a0 += TabEnt->Param;				\
 			RunLength += TabEnt->Param;			\
 			break;						\
@@ -420,6 +430,8 @@
 			goto doneBlack2da;				\
 		    case S_MakeUpW:					\
 		    case S_MakeUp:					\
+			if (!TabEnt->Param)				\
+			    goto zeroWhite2d;				\
 			a0 += TabEnt->Param;				\
 			RunLength += TabEnt->Param;			\
 			break;						\
@@ -437,6 +449,8 @@
 			goto doneWhite2db;				\
 		    case S_MakeUpW:					\
 		    case S_MakeUp:					\
+			if (!TabEnt->Param)				\
+			    goto zeroWhite2d;				\
 			a0 += TabEnt->Param;				\
 			RunLength += TabEnt->Param;			\
 			break;						\
@@ -453,6 +467,8 @@
 			goto doneBlack2db;				\
 		    case S_MakeUpB:					\
 		    case S_MakeUp:					\
+			if (!TabEnt->Param)				\
+			    goto zeroBlack2d;				\
 			a0 += TabEnt->Param;				\
 			RunLength += TabEnt->Param;			\
 			break;						\
@@ -493,6 +509,12 @@
 	default:							\
 	badMain2d:							\
 	    unexpected("MainTable", a0);				\
+	    goto eol2d;							\
+	zeroBlack2d:							\
+	    unexpected("BlackTable Zero length", a0);			\
+	    goto eol2d;							\
+	zeroWhite2d:							\
+	    unexpected("WhiteTable Zero length", a0);			\
 	    goto eol2d;							\
 	badBlack2d:							\
 	    unexpected("BlackTable", a0);				\
