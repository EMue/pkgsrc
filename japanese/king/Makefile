# $NetBSD: Makefile,v 1.8 2000/08/25 00:20:23 jlam Exp $
#

DISTNAME=	king-1.00-tb40-1
PKGNAME=	king-1.00
CATEGORIES=	japanese
EXTRACT_SUFX=	.i386.rpm
ONLY_FOR_PLATFORM=	NetBSD-*-i386

MAINTAINER=	sakamoto@netbsd.org
HOMEPAGE=	http://www.ibm.co.jp/software/internet/king/

RESTRICTED=	"A commercial licence needs to be purchased from IBM Corp"
NO_BIN_ON_CDROM=${RESTRICTED}
NO_SRC_ON_CDROM=${RESTRICTED}
NO_BIN_ON_FTP=	${RESTRICTED}
NO_SRC_ON_FTP=	${RESTRICTED}

KINGDISTDIR?=	/cdrom/linux
DISTDIR=	${KINGDISTDIR}

DEPENDS=	suse_base>=6.1:../../emulators/suse_base

EXTRACT_ONLY=	# empty
NO_BUILD=	yes
PLIST_SRC=	${WRKDIR}/PLIST_DYNAMIC

EMULSUBDIR=	emul/linux
EMULDIR=	${PREFIX}/${EMULSUBDIR}
SBINDIR=	${PREFIX}/sbin
LDD?=		${EMULDIR}/usr/bin/ldd

RPM2PKG=	${PREFIX}/sbin/rpm2pkg
RPM2PKGARGS=	-d ${PREFIX} -f ${PLIST_SRC} -p ${EMULSUBDIR}

do-fetch:
	@(if [ ! -f ${KINGDISTDIR}/${DISTNAME}${EXTRACT_SUFX} ]; then \
		${ECHO} "If CDROM not mounted, mount_cd9660 /dev/cd0a /cdrom; ${MAKE}"; \
		${ECHO} "If CDROM mounted to /mnt, ${MAKE} KINGDISTDIR=/mnt/linux"; \
		${FALSE}; \
	fi)

do-install:
	${RM} -f ${PLIST_SRC}
	${RPM2PKG} ${RPM2PKGARGS} ${KINGDISTDIR}/${DISTFILES}
	@${ECHO} "@exec %D/${EMULSUBDIR}/sbin/ldconfig -r %D/${EMULSUBDIR}" \
		>> ${PLIST_SRC}
	${EMULDIR}/sbin/ldconfig -r ${EMULDIR} || ${TRUE}

show-shlib-type:
	@${ECHO} linux-${MACHINE_ARCH}

.include "../../mk/bsd.pkg.mk"
