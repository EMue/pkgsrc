#! /bin/sh
#
# $NetBSD: INSTALL,v 1.3 2000/12/07 20:33:06 jlam Exp $

PKGNAME=$1
STAGE=$2

USER=@CUPS_USER@
GROUP=@CUPS_GROUP@
USERDIR=@USERDIR@

LOGDIR=/var/log/cups
REQUESTDIR=/var/spool/cups
SAMPLECONFDIR=${PKG_PREFIX}/share/examples/cups
CONFDIR=/etc/cups
CONFFILES="classes.conf client.conf cupsd.conf mime.convs mime.types printers.conf"

case ${STAGE} in
PRE-INSTALL)
	# We need to check that ${GROUP} exists before adding the user.
        #
	if ${USERDIR}/group info -e ${GROUP}
	then
		echo "Group '${GROUP}' already exists...proceeding."
	else
		echo "Creating '${GROUP}' group..."
		${USERDIR}/group add ${GROUP}
		echo "Done."
	fi

	# use finger to be able to use NIS, ...
	#
	if finger ${USER} 2>&1 | grep >/dev/null "no such user"
	then
		echo "Creating '${USER}' user..."
		${USERDIR}/user add \
			-c "CUPS pseudo-user" \
			-g ${GROUP} -s /sbin/nologin ${USER}
		echo "Done."
	else
		echo "User '${USER}' already exists...proceeding."
	fi
	;;

POST-INSTALL)
	mkdir -p ${CONFDIR}
	mkdir -p ${CONFDIR}/certs
	mkdir -p ${CONFDIR}/interfaces
	mkdir -p ${CONFDIR}/ppd
        mkdir -p ${LOGDIR}
        mkdir -p ${REQUESTDIR}
	chown ${USER}:${GROUP} ${REQUESTDIR}/tmp
	mkdir -p ${REQUESTDIR}/tmp
	chmod u+rwx,go-rwx,+t ${REQUESTDIR}/tmp
	chown ${USER}:${GROUP} ${REQUESTDIR}/tmp

	echo "Installing configuration files:"
	for file in ${CONFFILES}
	do
		FILE=${CONFDIR}/${file}
		SAMPLEFILE=${SAMPLECONFDIR}/${file}
		if [ -f ${FILE} ]
		then
			echo "    ${FILE} already exists"
		else
			echo "    ${FILE}"
			cp ${SAMPLEFILE} ${FILE}
			chmod 644 ${FILE}
		fi
	done
	cat << EOF
===========================================================================
Some files you might need to customize include the following:

EOF
	for file in ${CONFFILES}
	do
		FILE=${CONFDIR}/${file}
		echo "	${FILE}"
	done
	cat << EOF
===========================================================================
EOF
	;;

*)
	echo "Unexpected argument: ${STAGE}"
	exit 1
	;;
esac
exit 0
