--- eltorito.c.orig	Thu Apr 10 04:41:44 1997
+++ eltorito.c	Wed Oct 29 12:13:33 1997
@@ -28,11 +28,14 @@
 #include <sys/stat.h>
 #include <unistd.h>
 #include <fcntl.h>
-#include <malloc.h>
+#include <stdlib.h>
 
 #include "mkisofs.h"
 #include "iso9660.h"
 
+#undef MIN
+#define MIN(a, b) (((a) < (b))? (a): (b))
+
 static struct eltorito_validation_entry valid_desc;
 static struct eltorito_defaultboot_entry default_desc;
 
@@ -158,7 +161,7 @@
      * but who really reads this stuff!
      */
     if (publisher)
-	memcpy_max(valid_desc.id,  publisher, strlen(publisher));
+	memcpy_max(valid_desc.id,  publisher, MIN(31, strlen(publisher)));
     
     valid_desc.key1[0] = 0x55;
     valid_desc.key2[0] = 0xAA;
