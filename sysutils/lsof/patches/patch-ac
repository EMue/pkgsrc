$NetBSD: patch-ac,v 1.4 1999/06/25 02:41:15 hubertf Exp $

--- dialects/n+obsd/dproc.c.orig	Tue Jun 22 23:04:06 1999
+++ dialects/n+obsd/dproc.c	Fri Jun 25 04:13:10 1999
@@ -150,6 +150,9 @@
 gather_proc_info()
 {
 	struct filedesc fd;
+#if __NetBSD_Version__ >= 104010000
+	struct cwdinfo cwdi;
+#endif
 	int i, nf;
 	MALLOC_S nb;
 	static struct file **ofb = NULL;
@@ -231,6 +234,20 @@
 		(UID_ARG)uid, p->P_COMM, (int)pss, (int)sf);
 	    Plf = (struct lfile *)NULL;
 	    Kpa = (KA_T)p->P_ADDR;
+#if __NetBSD_Version__ >= 104010000
+       /*
+        * Save current working directory framework information.
+        */
+           (void)memset(&cwdi, 0, sizeof(cwdi));
+           if (p->kp_proc.p_cwdi) {
+               if (kvm_read(Kd, (u_long)p->kp_proc.p_cwdi, &cwdi, sizeof(cwdi))
+                   != sizeof(cwdi)) {
+                       fprintf(stderr, "%s: cannot read cwdinfo: %s\n", Pn,
+                           kvm_geterr(Kd));
+                       Exit(1);
+               }
+           }
+#endif
 	/*
 	 * Save current working directory information.
 	 */
